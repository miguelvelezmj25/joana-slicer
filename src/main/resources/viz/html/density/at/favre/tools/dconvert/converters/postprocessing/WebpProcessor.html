<html><body><pre><code><div>  /*</div><div>   *  Copyright 2016 Patrick Favre-Bulle</div><div>   *</div><div>   *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</div><div>   *  you may not use this file except in compliance with the License.</div><div>   *  You may obtain a copy of the License at</div><div>   *</div><div>   *      http://www.apache.org/licenses/LICENSE-2.0</div><div>   *</div><div>   * Unless required by applicable law or agreed to in writing, software</div><div>   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</div><div>   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</div><div>   * See the License for the specific language governing permissions and</div><div>   * limitations under the License.</div><div>   */</div><div>  </div><div>  package at.favre.tools.dconvert.converters.postprocessing;</div><div>  </div><div>  import at.favre.tools.dconvert.arg.Arguments;</div><div>  import at.favre.tools.dconvert.arg.ImageType;</div><div>  import at.favre.tools.dconvert.converters.Result;</div><div>  import at.favre.tools.dconvert.util.MiscUtil;</div><div>  import at.favre.tools.dconvert.util.PostProcessorUtil;</div><div>  </div><div>  import java.io.File;</div><div>  import java.util.Collections;</div><div>  </div><div>  /** Converts pngs/jpegs to lossless/lossy webp */</div><div>  public class WebpProcessor extends APostProcessor {</div><div>  </div><div>    @Override</div><div>    public Result synchronizedProcess(File rawFile, boolean keepOriginal) {</div><div>      try {</div><div>*       ImageType compression = Arguments.getImageType(rawFile);</div><div>        String[] additionalArgs;</div><div>*       if (compression == ImageType.PNG || compression == ImageType.GIF) {</div><div>*         additionalArgs = new String[] {&quot;-lossless&quot;, &quot;-alpha_filter&quot;, &quot;best&quot;, &quot;-m&quot;, &quot;6&quot;};</div><div>*       } else if (compression == ImageType.JPG) {</div><div>*         additionalArgs = new String[] {&quot;-m&quot;, &quot;6&quot;, &quot;-q&quot;, &quot;90&quot;};</div><div>        } else {</div><div>*         return null;</div><div>        }</div><div>  </div><div>*       String[] finalArg =</div><div>*           MiscUtil.concat(</div><div>*               MiscUtil.concat(new String[] {&quot;cwebp&quot;}, additionalArgs),</div><div>                new String[] {&quot;%%sourceFilePath%%&quot;, &quot;-o&quot;, &quot;%%outFilePath%%&quot;});</div><div>  </div><div>*       return PostProcessorUtil.runImageOptimizer(</div><div>            rawFile, compression, finalArg, keepOriginal, &quot;webp&quot;);</div><div>      } catch (Exception e) {</div><div>        return new Result(</div><div>            &quot;could not execute post processor &quot; + getClass().getSimpleName(),</div><div>            e,</div><div>            Collections.singletonList(rawFile));</div><div>      }</div><div>    }</div><div>  </div><div>    @Override</div><div>    public boolean isSupported() {</div><div>*     return PostProcessorUtil.canRunCmd(new String[] {&quot;cwebp&quot;, &quot;-h&quot;});</div><div>    }</div><div>  }</div></code></pre></body></html>