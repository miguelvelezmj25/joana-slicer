<html><body><pre><code><div>  /*</div><div>   *  Copyright 2016 Patrick Favre-Bulle</div><div>   *</div><div>   *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</div><div>   *  you may not use this file except in compliance with the License.</div><div>   *  You may obtain a copy of the License at</div><div>   *</div><div>   *      http://www.apache.org/licenses/LICENSE-2.0</div><div>   *</div><div>   * Unless required by applicable law or agreed to in writing, software</div><div>   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</div><div>   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</div><div>   * See the License for the specific language governing permissions and</div><div>   * limitations under the License.</div><div>   */</div><div>  </div><div>  package at.favre.tools.dconvert.converters;</div><div>  </div><div>  import at.favre.tools.dconvert.arg.Arguments;</div><div>  import at.favre.tools.dconvert.arg.ImageType;</div><div>  import at.favre.tools.dconvert.converters.descriptors.PostfixDescriptor;</div><div>  import at.favre.tools.dconvert.util.MiscUtil;</div><div>  </div><div>  import java.awt.*;</div><div>  import java.io.File;</div><div>  import java.io.IOException;</div><div>  import java.io.PrintWriter;</div><div>  import java.util.ArrayList;</div><div>  import java.util.List;</div><div>  </div><div>  /** Needed info to convert for Android */</div><div>* public class IOSConverter extends APlatformConverter&lt;PostfixDescriptor&gt; {</div><div>    public static final String ROOT_FOLDER = &quot;AssetCatalog&quot;;</div><div>    private static final String IOS_FOLDER_NAME = &quot;ios&quot;;</div><div>  </div><div>    public static List&lt;PostfixDescriptor&gt; getIosDescriptors() {</div><div>*     List&lt;PostfixDescriptor&gt; list = new ArrayList&lt;PostfixDescriptor&gt;();</div><div>*     list.add(new PostfixDescriptor(1, &quot;1x&quot;, &quot;&quot;));</div><div>*     list.add(new PostfixDescriptor(2, &quot;2x&quot;, &quot;@2x&quot;));</div><div>*     list.add(new PostfixDescriptor(3, &quot;3x&quot;, &quot;@3x&quot;));</div><div>*     return list;</div><div>    }</div><div>  </div><div>    @Override</div><div>    public List&lt;PostfixDescriptor&gt; usedOutputDensities(Arguments arguments) {</div><div>*     return getIosDescriptors();</div><div>    }</div><div>  </div><div>    @Override</div><div>    public PostfixDescriptor originalOutputDensities() {</div><div>*     return new PostfixDescriptor(1, &quot;1x&quot;, &quot;&quot;);</div><div>    }</div><div>  </div><div>    @Override</div><div>    public String getConverterName() {</div><div>*     return &quot;ios-converter&quot;;</div><div>    }</div><div>  </div><div>    @Override</div><div>    public File createMainSubFolder(</div><div>        File destinationFolder, String targetImageFileName, Arguments arguments) {</div><div>*     if (arguments.platform.size() &gt; 1) {</div><div>*       destinationFolder =</div><div>*           MiscUtil.createAndCheckFolder(</div><div>*               new File(destinationFolder, IOS_FOLDER_NAME).getAbsolutePath(), arguments.dryRun);</div><div>      }</div><div>*     if (arguments.iosCreateImagesetFolders) {</div><div>*       return MiscUtil.createAndCheckFolder(</div><div>*           new File(destinationFolder, targetImageFileName + &quot;.imageset&quot;).getAbsolutePath(),</div><div>            arguments.dryRun);</div><div>      } else {</div><div>*       return MiscUtil.createAndCheckFolder(</div><div>*           new File(destinationFolder, ROOT_FOLDER).getAbsolutePath(), arguments.dryRun);</div><div>      }</div><div>    }</div><div>  </div><div>    @Override</div><div>    public File createFolderForOutputFile(</div><div>        File mainSubFolder,</div><div>        PostfixDescriptor density,</div><div>        Dimension dimension,</div><div>        String targetFileName,</div><div>        Arguments arguments) {</div><div>*     return mainSubFolder;</div><div>    }</div><div>  </div><div>    @Override</div><div>    public String createDestinationFileNameWithoutExtension(</div><div>        PostfixDescriptor density, Dimension dimension, String targetFileName, Arguments arguments) {</div><div>*     return targetFileName + density.postFix;</div><div>    }</div><div>  </div><div>    @Override</div><div>    public void onPreExecute(</div><div>        File dstFolder,</div><div>        String targetFileName,</div><div>        List&lt;PostfixDescriptor&gt; densityDescriptions,</div><div>        ImageType imageType,</div><div>        Arguments arguments)</div><div>        throws Exception {</div><div>*     if (!arguments.dryRun &amp;&amp; arguments.iosCreateImagesetFolders) {</div><div>*       writeContentsJson(</div><div>            dstFolder,</div><div>            targetFileName,</div><div>            densityDescriptions,</div><div>*           Arguments.getOutCompressionForType(arguments.outputCompressionMode, imageType));</div><div>      }</div><div>    }</div><div>  </div><div>    @Override</div><div>    public void onPostExecute(Arguments arguments) {}</div><div>  </div><div>    private void writeContentsJson(</div><div>        File dstFolder,</div><div>        String targetFileName,</div><div>        List&lt;PostfixDescriptor&gt; iosDensityDescriptions,</div><div>        List&lt;ImageType.ECompression&gt; compressions)</div><div>        throws IOException {</div><div>*     File contentJson = new File(dstFolder, &quot;Contents.json&quot;);</div><div>  </div><div>      if (contentJson.exists()) {</div><div>        contentJson.delete();</div><div>      }</div><div>      contentJson.createNewFile();</div><div>  </div><div>*     PrintWriter out = new PrintWriter(contentJson);</div><div>*     out.println(createContentsJson(targetFileName, iosDensityDescriptions, compressions));</div><div>*     out.close();</div><div>      //    try (PrintWriter out = new PrintWriter(contentJson)) {</div><div>      //      out.println(createContentsJson(targetFileName, iosDensityDescriptions, compressions));</div><div>      //    }</div><div>    }</div><div>  </div><div>    private String createContentsJson(</div><div>        String targetFileName,</div><div>        List&lt;PostfixDescriptor&gt; iosDensityDescriptions,</div><div>        List&lt;ImageType.ECompression&gt; compressions) {</div><div>*     StringBuilder sb = new StringBuilder(&quot;{\n\t\&quot;images\&quot;: [&quot;);</div><div>*     for (ImageType.ECompression compression : compressions) {</div><div>*       for (PostfixDescriptor densityDescription : iosDensityDescriptions) {</div><div>*         sb.append(</div><div>              &quot;\n\t\t{\n&quot;</div><div>                  + &quot;\t\t\t\&quot;filename\&quot;: \&quot;&quot;</div><div>                  + targetFileName</div><div>                  + densityDescription.postFix</div><div>                  + &quot;.&quot;</div><div>*                 + compression.name().toLowerCase()</div><div>                  + &quot;\&quot;,\n&quot;</div><div>                  + &quot;\t\t\t\&quot;idiom\&quot;: \&quot;universal\&quot;,\n&quot;</div><div>                  + &quot;\t\t\t\&quot;scale\&quot;: \&quot;&quot;</div><div>                  + densityDescription.name</div><div>                  + &quot;\&quot;\n&quot;</div><div>                  + &quot;\t\t},&quot;);</div><div>        }</div><div>      }</div><div>*     sb.setLength(sb.length() - 1);</div><div>*     sb.append(&quot;\n\t],\n\t\&quot;info\&quot;: {\n\t\t\&quot;author\&quot;: \&quot;xcode\&quot;,\n\t\t\&quot;version\&quot;: 1\n\t}\n}&quot;);</div><div>  </div><div>*     return sb.toString();</div><div>    }</div><div>  </div><div>    @Override</div><div>    public void clean(Arguments arguments) {</div><div>*     if (arguments.platform.size() == 1) {</div><div>*       if (arguments.iosCreateImagesetFolders) {</div><div>*         for (File filesToProcess : arguments.filesToProcess) {</div><div>*           MiscUtil.deleteFolder(</div><div>                new File(</div><div>                    arguments.dst,</div><div>*                   MiscUtil.getFileNameWithoutExtension(filesToProcess) + &quot;.imageset&quot;));</div><div>          }</div><div>        } else {</div><div>*         MiscUtil.deleteFolder(new File(arguments.dst, ROOT_FOLDER));</div><div>        }</div><div>      } else {</div><div>*       MiscUtil.deleteFolder(new File(arguments.dst, IOS_FOLDER_NAME));</div><div>      }</div><div>    }</div><div>  }</div></code></pre></body></html>