<html><body style="font-size:16px;width:1000px;"><pre><code><div> /*</div><div>  * Copyright 2013, Morten Nobel-Joergensen</div><div>  *</div><div>  * License: The BSD 3-Clause License</div><div>  * http://opensource.org/licenses/BSD-3-Clause</div><div>  */</div><div> package com.mortennobel.imagescaling;</div><div> </div><div> import java.awt.*;</div><div> import java.awt.image.BufferedImage;</div><div> </div><div> /**</div><div>  * This code is very inspired on Chris Campbells article &quot;The Perils of Image.getScaledInstance()&quot;</div><div>  *</div><div>  * &lt;p&gt;The article can be found here:</div><div>  * http://today.java.net/pub/a/today/2007/04/03/perils-of-image-getscaledinstance.html</div><div>  *</div><div>  * &lt;p&gt;Note that the filter method is threadsafe</div><div>  */</div><div> public class MultiStepRescaleOp extends AdvancedResizeOp {</div><div>   private final Object renderingHintInterpolation;</div><div> </div><div>   public MultiStepRescaleOp(int dstWidth, int dstHeight) {</div><div>     this(dstWidth, dstHeight, RenderingHints.VALUE_INTERPOLATION_BILINEAR);</div><div>   }</div><div> </div><div>   public MultiStepRescaleOp(int dstWidth, int dstHeight, Object renderingHintInterpolation) {</div><div style="background-color:MediumSpringGreen;">     this(</div><div style="background-color:MediumSpringGreen;">         DimensionConstrain.createAbsolutionDimension(dstWidth, dstHeight),</div><div>         renderingHintInterpolation);</div><div>   }</div><div> </div><div>   public MultiStepRescaleOp(DimensionConstrain dimensionConstain) {</div><div>     this(dimensionConstain, RenderingHints.VALUE_INTERPOLATION_BILINEAR);</div><div>   }</div><div> </div><div>   public MultiStepRescaleOp(</div><div>       DimensionConstrain dimensionConstain, Object renderingHintInterpolation) {</div><div style="background-color:MediumSpringGreen;">     super(dimensionConstain);</div><div>     this.renderingHintInterpolation = renderingHintInterpolation;</div><div style="background-color:MediumSpringGreen;">     assert RenderingHints.KEY_INTERPOLATION.isCompatibleValue(renderingHintInterpolation)</div><div>         : &quot;Rendering hint &quot; + renderingHintInterpolation + &quot; is not compatible with interpolation&quot;;</div><div>   }</div><div> </div><div>   public BufferedImage doFilter(</div><div>       BufferedImage img, BufferedImage dest, int dstWidth, int dstHeight) {</div><div>     int type =</div><div style="background-color:MediumSpringGreen;">         (img.getTransparency() == Transparency.OPAQUE)</div><div>             ? BufferedImage.TYPE_INT_RGB</div><div>             : BufferedImage.TYPE_INT_ARGB;</div><div>     BufferedImage ret = img;</div><div>     int w, h;</div><div> </div><div>     // Use multi-step technique: start with original size, then</div><div>     // scale down in multiple passes with drawImage()</div><div>     // until the target size is reached</div><div style="background-color:MediumSpringGreen;">     w = img.getWidth();</div><div style="background-color:MediumSpringGreen;">     h = img.getHeight();</div><div> </div><div>     do {</div><div style="background-color:MediumSpringGreen;">       if (w &gt; dstWidth) {</div><div style="background-color:MediumSpringGreen;">         w /= 2;</div><div style="background-color:MediumSpringGreen;">         if (w &lt; dstWidth) {</div><div>           w = dstWidth;</div><div>         }</div><div>       } else {</div><div>         w = dstWidth;</div><div>       }</div><div> </div><div style="background-color:MediumSpringGreen;">       if (h &gt; dstHeight) {</div><div style="background-color:MediumSpringGreen;">         h /= 2;</div><div style="background-color:MediumSpringGreen;">         if (h &lt; dstHeight) {</div><div>           h = dstHeight;</div><div>         }</div><div>       } else {</div><div>         h = dstHeight;</div><div>       }</div><div> </div><div>       BufferedImage tmp;</div><div style="background-color:MediumSpringGreen;">       if (dest != null</div><div style="background-color:MediumSpringGreen;">           &amp;&amp; dest.getWidth() == w</div><div style="background-color:MediumSpringGreen;">           &amp;&amp; dest.getHeight() == h</div><div>           &amp;&amp; w == dstWidth</div><div>           &amp;&amp; h == dstHeight) {</div><div>         tmp = dest;</div><div>       } else {</div><div style="background-color:MediumSpringGreen;">         tmp = new BufferedImage(w, h, type);</div><div>       }</div><div style="background-color:MediumSpringGreen;">       Graphics2D g2 = tmp.createGraphics();</div><div>       g2.setRenderingHint(RenderingHints.KEY_INTERPOLATION, renderingHintInterpolation);</div><div>       g2.drawImage(ret, 0, 0, w, h, null);</div><div>       g2.dispose();</div><div> </div><div>       ret = tmp;</div><div style="background-color:MediumSpringGreen;">     } while (w != dstWidth || h != dstHeight);</div><div> </div><div style="background-color:MediumSpringGreen;">     return ret;</div><div>   }</div><div> }</div></code></pre></body></html>