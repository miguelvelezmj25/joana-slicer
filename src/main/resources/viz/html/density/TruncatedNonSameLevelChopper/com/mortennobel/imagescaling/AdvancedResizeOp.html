<html><body style="font-size:16px;width:1000px;"><pre><code><div> /*</div><div>  * Copyright 2013, Morten Nobel-Joergensen</div><div>  *</div><div>  * License: The BSD 3-Clause License</div><div>  * http://opensource.org/licenses/BSD-3-Clause</div><div>  */</div><div> package com.mortennobel.imagescaling;</div><div> </div><div> import java.awt.*;</div><div> import java.awt.geom.Point2D;</div><div> import java.awt.geom.Rectangle2D;</div><div> import java.awt.image.BufferedImage;</div><div> import java.awt.image.BufferedImageOp;</div><div> import java.awt.image.ColorModel;</div><div> import java.util.ArrayList;</div><div> import java.util.List;</div><div> </div><div> /** @author Morten Nobel-Joergensen */</div><div> public abstract class AdvancedResizeOp implements BufferedImageOp {</div><div>   public enum UnsharpenMask {</div><div>     None(0),</div><div>     Soft(0.15f),</div><div>     Normal(0.3f),</div><div>     VerySharp(0.45f),</div><div>     Oversharpened(0.60f);</div><div>     private final float factor;</div><div> </div><div>     UnsharpenMask(float factor) {</div><div>       this.factor = factor;</div><div>     }</div><div>   }</div><div> </div><div>   private final List&lt;ProgressListener&gt; listeners = new ArrayList&lt;ProgressListener&gt;();</div><div> </div><div>   private final DimensionConstrain dimensionConstrain;</div><div>   private UnsharpenMask unsharpenMask = UnsharpenMask.None;</div><div> </div><div>   public AdvancedResizeOp(DimensionConstrain dimensionConstrain) {</div><div>     this.dimensionConstrain = dimensionConstrain;</div><div>   }</div><div> </div><div>   public UnsharpenMask getUnsharpenMask() {</div><div>     return unsharpenMask;</div><div>   }</div><div> </div><div>   public void setUnsharpenMask(UnsharpenMask unsharpenMask) {</div><div>     this.unsharpenMask = unsharpenMask;</div><div>   }</div><div> </div><div>   protected void fireProgressChanged(float fraction) {</div><div>     for (ProgressListener progressListener : listeners) {</div><div>       progressListener.notifyProgress(fraction);</div><div>     }</div><div>   }</div><div> </div><div>   public final void addProgressListener(ProgressListener progressListener) {</div><div>     listeners.add(progressListener);</div><div>   }</div><div> </div><div>   public final boolean removeProgressListener(ProgressListener progressListener) {</div><div>     return listeners.remove(progressListener);</div><div>   }</div><div> </div><div>   public final BufferedImage filter(BufferedImage src, BufferedImage dest) {</div><div style="background-color:MediumSpringGreen;">     Dimension dstDimension =</div><div style="background-color:MediumSpringGreen;">         dimensionConstrain.getDimension(new Dimension(src.getWidth(), src.getHeight()));</div><div style="background-color:MediumSpringGreen;">     int dstWidth = dstDimension.width;</div><div style="background-color:MediumSpringGreen;">     int dstHeight = dstDimension.height;</div><div style="background-color:MediumSpringGreen;">     BufferedImage bufferedImage = doFilter(src, dest, dstWidth, dstHeight);</div><div> </div><div>     //    if (unsharpenMask != UnsharpenMask.None) {</div><div>     //      UnsharpFilter unsharpFilter = new UnsharpFilter();</div><div>     //      unsharpFilter.setRadius(2f);</div><div>     //      unsharpFilter.setAmount(unsharpenMask.factor);</div><div>     //      unsharpFilter.setThreshold(10);</div><div>     //      return unsharpFilter.filter(bufferedImage, null);</div><div>     //    }</div><div> </div><div>     return bufferedImage;</div><div>   }</div><div> </div><div>   protected abstract BufferedImage doFilter(</div><div>       BufferedImage src, BufferedImage dest, int dstWidth, int dstHeight);</div><div> </div><div>   /** {@inheritDoc} */</div><div>   public final Rectangle2D getBounds2D(BufferedImage src) {</div><div>     return new Rectangle(0, 0, src.getWidth(), src.getHeight());</div><div>   }</div><div> </div><div>   /** {@inheritDoc} */</div><div>   public final BufferedImage createCompatibleDestImage(BufferedImage src, ColorModel destCM) {</div><div>     if (destCM == null) {</div><div>       destCM = src.getColorModel();</div><div>     }</div><div>     return new BufferedImage(</div><div>         destCM,</div><div>         destCM.createCompatibleWritableRaster(src.getWidth(), src.getHeight()),</div><div>         destCM.isAlphaPremultiplied(),</div><div>         null);</div><div>   }</div><div> </div><div>   /** {@inheritDoc} */</div><div>   public final Point2D getPoint2D(Point2D srcPt, Point2D dstPt) {</div><div>     return (Point2D) srcPt.clone();</div><div>   }</div><div> </div><div>   /** {@inheritDoc} */</div><div>   public final RenderingHints getRenderingHints() {</div><div>     return null;</div><div>   }</div><div> }</div></code></pre></body></html>