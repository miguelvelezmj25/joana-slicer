<html><body style="font-size:16px;width:1000px;"><pre><code><div> /*</div><div>  *  Copyright 2016 Patrick Favre-Bulle</div><div>  *</div><div>  *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</div><div>  *  you may not use this file except in compliance with the License.</div><div>  *  You may obtain a copy of the License at</div><div>  *</div><div>  *      http://www.apache.org/licenses/LICENSE-2.0</div><div>  *</div><div>  * Unless required by applicable law or agreed to in writing, software</div><div>  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</div><div>  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</div><div>  * See the License for the specific language governing permissions and</div><div>  * limitations under the License.</div><div>  */</div><div> </div><div> package at.favre.tools.dconvert;</div><div> </div><div> import at.favre.tools.dconvert.arg.*;</div><div> import at.favre.tools.dconvert.util.MiscUtil;</div><div> </div><div> import java.io.File;</div><div> import java.io.IOException;</div><div> import java.util.HashSet;</div><div> import java.util.List;</div><div> import java.util.Set;</div><div> </div><div> /** Entry point of the app. Use arg -h to get help. */</div><div> public final class Convert {</div><div> </div><div>   private Convert() {}</div><div> </div><div>   private static float getScale() {</div><div>     return 1;</div><div>   }</div><div> </div><div>   public static void main(String[] rawArgs) {</div><div>     boolean androidIncludeLdpiTvdpi = false;</div><div>     boolean androidMipmapInsteadOfDrawable = false;</div><div>     boolean antiAliasing = false;</div><div>     boolean clean = true;</div><div>     float compressionQuality = 0.9f;</div><div>     EScalingAlgorithm downScalingAlgorithm = EScalingAlgorithm.MITCHELL;</div><div>     boolean dryRun = false;</div><div>     boolean haltOnError = false;</div><div>     boolean iosCreateImagesetFolders = false;</div><div>     boolean keepOriginalPostProcessedFiles = true;</div><div>     String outCompression = &quot;jpg&quot;;</div><div>     String selectedPlatform = &quot;android&quot;;</div><div>     boolean postProcessorMozJpeg = false;</div><div>     boolean postProcessorPngCrush = false;</div><div>     boolean postProcessorWebp = false;</div><div>     String roundingMode = &quot;floor&quot;;</div><div style="background-color:#65d1fc;">     float scale = getScale();</div><div>     boolean scaleIsHeightDp = false;</div><div>     boolean skipExisting = true;</div><div>     boolean skipUpscaling = false;</div><div>     EScalingAlgorithm upScalingAlgorithm = EScalingAlgorithm.MITCHELL;</div><div>     boolean VERBOSE = true;</div><div> </div><div>     File src = new File(&quot;./pictures/person.jpg&quot;);</div><div>     File dst = new File(&quot;./output&quot;);</div><div>     Set&lt;EPlatform&gt; platform = getPlatform(selectedPlatform);</div><div>     EOutputCompressionMode outputCompressionMode = getOutCompression(outCompression);</div><div>     EScaleMode scaleMode = scaleMode(false, scaleIsHeightDp);</div><div>     RoundingHandler.Strategy roundingHandler = getRoundingHandler(roundingMode);</div><div> </div><div style="background-color:MediumSpringGreen;">     final Arguments args =</div><div>         new Arguments(</div><div>             src,</div><div>             dst,</div><div>             scale,</div><div>             platform,</div><div>             outputCompressionMode,</div><div>             scaleMode,</div><div>             downScalingAlgorithm,</div><div>             upScalingAlgorithm,</div><div>             compressionQuality,</div><div>             1,</div><div>             skipExisting,</div><div>             skipUpscaling,</div><div>             VERBOSE,</div><div>             androidIncludeLdpiTvdpi,</div><div>             haltOnError,</div><div>             androidMipmapInsteadOfDrawable,</div><div>             iosCreateImagesetFolders,</div><div>             postProcessorPngCrush,</div><div>             postProcessorMozJpeg,</div><div>             postProcessorWebp,</div><div>             antiAliasing,</div><div>             dryRun,</div><div>             keepOriginalPostProcessedFiles,</div><div>             roundingHandler,</div><div>             false,</div><div>             clean);</div><div> </div><div>     //        if (rawArgs.length &lt; 1) {</div><div>     //            new GUI().launchApp(rawArgs);</div><div>     //            return;</div><div>     //        }</div><div>     //</div><div>     //        Arguments args = CLIInterpreter.parse(analysisArgs.toArray(new String[0]));</div><div>     //</div><div>     //        if (args == null) {</div><div>     //            return;</div><div>     //        } else if (args == Arguments.START_GUI) {</div><div>     //            System.out.println(&quot;start gui&quot;);</div><div>     //            new GUI().launchApp(rawArgs);</div><div>     //            return;</div><div>     //        }</div><div> </div><div>     System.out.println(&quot;start converting &quot; + args.filesToProcess.size() + &quot; files&quot;);</div><div> </div><div>     new DConvert()</div><div style="background-color:MediumSpringGreen;">         .execute(</div><div>             args,</div><div>             true,</div><div>             new DConvert.HandlerCallback() {</div><div>               @Override</div><div>               public void onProgress(float progress) {</div><div>                 try {</div><div>                   System.out.write(MiscUtil.getCmdProgressBar(progress).getBytes());</div><div>                 } catch (IOException e) {</div><div>                   e.printStackTrace();</div><div>                 }</div><div>               }</div><div> </div><div>               @Override</div><div>               public void onFinished(</div><div>                   int finishedJobs,</div><div>                   List&lt;Exception&gt; exceptions,</div><div>                   long time,</div><div>                   boolean haltedDuringProcess,</div><div>                   String log) {</div><div>                 System.out.print(MiscUtil.getCmdProgressBar(1f));</div><div> </div><div>                 System.out.println();</div><div> </div><div>                 if (args.verboseLog) {</div><div>                   System.out.println(&quot;Log:&quot;);</div><div>                   System.out.println(log);</div><div>                 }</div><div> </div><div>                 if (haltedDuringProcess) {</div><div>                   System.err.println(&quot;abort due to error&quot;);</div><div>                 }</div><div>                 if (exceptions.size() &gt; 0) {</div><div>                   System.err.println(&quot;found &quot; + exceptions.size() + &quot; errors during execution&quot;);</div><div>                   if (args.verboseLog) {</div><div>                     for (Exception exception : exceptions) {</div><div>                       System.err.println(&quot;\terror: &quot; + exception.getMessage());</div><div>                       exception.printStackTrace();</div><div>                     }</div><div>                   }</div><div>                 }</div><div>                 System.out.println(</div><div>                     &quot;execution finished (&quot;</div><div>                         + time</div><div>                         + &quot;ms) with &quot;</div><div>                         + finishedJobs</div><div>                         + &quot; finsihed jobs and &quot;</div><div>                         + exceptions.size()</div><div>                         + &quot; errors&quot;);</div><div>               }</div><div>             });</div><div>   }</div><div> </div><div>   private static RoundingHandler.Strategy getRoundingHandler(String roundingMode) {</div><div>     if (roundingMode.equals(&quot;round&quot;)) {</div><div>       return RoundingHandler.Strategy.ROUND_HALF_UP;</div><div>     }</div><div>     if (roundingMode.equals(&quot;ceil&quot;)) {</div><div>       return RoundingHandler.Strategy.CEIL;</div><div>     }</div><div>     if (roundingMode.equals(&quot;floor&quot;)) {</div><div>       return RoundingHandler.Strategy.FLOOR;</div><div>     }</div><div>     throw new RuntimeException(&quot;unknown mode: &quot; + roundingMode);</div><div>   }</div><div> </div><div>   private static EScaleMode scaleMode(boolean dp, boolean scaleIsHeightDp) {</div><div>     if (dp &amp;&amp; scaleIsHeightDp) {</div><div>       return EScaleMode.DP_HEIGHT;</div><div>     } else if (dp &amp;&amp; !scaleIsHeightDp) {</div><div>       return EScaleMode.DP_WIDTH;</div><div>     } else {</div><div>       return EScaleMode.FACTOR;</div><div>     }</div><div>   }</div><div> </div><div>   private static EOutputCompressionMode getOutCompression(String outCompression) {</div><div>     if (outCompression.equals(&quot;strict&quot;)) {</div><div>       return EOutputCompressionMode.SAME_AS_INPUT_STRICT;</div><div>     }</div><div>     if (outCompression.equals(&quot;png&quot;)) {</div><div>       return EOutputCompressionMode.AS_PNG;</div><div>     }</div><div>     if (outCompression.equals(&quot;jpg&quot;)) {</div><div>       return EOutputCompressionMode.AS_JPG;</div><div>     }</div><div>     if (outCompression.equals(&quot;gif&quot;)) {</div><div>       return EOutputCompressionMode.AS_GIF;</div><div>     }</div><div>     if (outCompression.equals(&quot;bmp&quot;)) {</div><div>       return EOutputCompressionMode.AS_BMP;</div><div>     }</div><div>     if (outCompression.equals(&quot;png+jpg&quot;)) {</div><div>       return EOutputCompressionMode.AS_JPG_AND_PNG;</div><div>     }</div><div> </div><div>     throw new RuntimeException(&quot;unknown compression type: &quot; + outCompression);</div><div>   }</div><div> </div><div>   private static Set&lt;EPlatform&gt; getPlatform(String platform) {</div><div>     Set&lt;EPlatform&gt; platformSet = new HashSet&lt;EPlatform&gt;();</div><div> </div><div>     if (platform.equals(&quot;all&quot;)) {</div><div>       platformSet = EPlatform.getAll();</div><div>     } else if (platform.equals(&quot;android&quot;)) {</div><div>       platformSet.add(EPlatform.ANDROID);</div><div>     } else if (platform.equals(&quot;ios&quot;)) {</div><div>       platformSet.add(EPlatform.IOS);</div><div>     } else if (platform.equals(&quot;win&quot;)) {</div><div>       platformSet.add(EPlatform.WINDOWS);</div><div>     } else if (platform.equals(&quot;web&quot;)) {</div><div>       platformSet.add(EPlatform.WEB);</div><div>     } else {</div><div>       System.err.println(&quot;unknown mode: &quot; + platform);</div><div>     }</div><div> </div><div>     return platformSet;</div><div>   }</div><div> </div><div>   private static boolean postProcess(boolean option) {</div><div>     return false;</div><div>   }</div><div> }</div></code></pre></body></html>