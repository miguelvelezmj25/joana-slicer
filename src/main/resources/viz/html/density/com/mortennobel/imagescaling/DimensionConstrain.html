<html><body><pre><code><div>  /*</div><div>   * Copyright 2013, Morten Nobel-Joergensen</div><div>   *</div><div>   * License: The BSD 3-Clause License</div><div>   * http://opensource.org/licenses/BSD-3-Clause</div><div>   */</div><div>  package com.mortennobel.imagescaling;</div><div>  </div><div>  import java.awt.*;</div><div>  </div><div>  /**</div><div>   * This class let you create dimension constrains based on a actual image.</div><div>   *</div><div>   * &lt;p&gt;Class may be subclassed to create user defined behavior. To do this you need to overwrite the</div><div>   * method getDimension(Dimension).</div><div>   */</div><div>  public class DimensionConstrain {</div><div>    protected DimensionConstrain() {}</div><div>  </div><div>    /**</div><div>     * Will always return a dimension with positive width and height;</div><div>     *</div><div>     * @param dimension of the unscaled image</div><div>     * @return the dimension of the scaled image</div><div>     */</div><div>    public Dimension getDimension(Dimension dimension) {</div><div>      return dimension;</div><div>    }</div><div>  </div><div>    /**</div><div>     * Used when the destination size is fixed. This may not keep the image aspect radio</div><div>     *</div><div>     * @param width destination dimension width</div><div>     * @param height destination dimension height</div><div>     * @return destination dimension (width x height)</div><div>     */</div><div>    public static DimensionConstrain createAbsolutionDimension(final int width, final int height) {</div><div>*     assert width &gt; 0 &amp;&amp; height &gt; 0 : &quot;Dimension must be a positive integer&quot;;</div><div>*     return new DimensionConstrain() {</div><div>        public Dimension getDimension(Dimension dimension) {</div><div>*         return new Dimension(width, height);</div><div>        }</div><div>      };</div><div>    }</div><div>  </div><div>    /**</div><div>     * Used when the destination size is relative to the source. This keeps the image aspect radio</div><div>     *</div><div>     * @param fraction resize fraction (must be a positive number)</div><div>     * @return the new dimension (the input dimension times the fraction)</div><div>     */</div><div>    public static DimensionConstrain createRelativeDimension(final float fraction) {</div><div>      return createRelativeDimension(fraction, fraction);</div><div>    }</div><div>  </div><div>    /**</div><div>     * Used when the destination size is relative to the source. This keeps the image aspect radio if</div><div>     * fractionWidth equals fractionHeight</div><div>     *</div><div>     * @param</div><div>     * @return</div><div>     */</div><div>    public static DimensionConstrain createRelativeDimension(</div><div>        final float fractionWidth, final float fractionHeight) {</div><div>      assert fractionHeight &gt; 0 &amp;&amp; fractionWidth &gt; 0 : &quot;Fractions must be larger than 0.0&quot;;</div><div>      return new DimensionConstrain() {</div><div>        public Dimension getDimension(Dimension dimension) {</div><div>          int width = Math.max(1, Math.round(fractionWidth * dimension.width));</div><div>          int height = Math.max(1, Math.round(fractionHeight * dimension.height));</div><div>          return new Dimension(width, height);</div><div>        }</div><div>      };</div><div>    }</div><div>  </div><div>    /**</div><div>     * Forces the image to keep radio and be keeped within the width and height</div><div>     *</div><div>     * @param width</div><div>     * @param height</div><div>     * @return</div><div>     */</div><div>    public static DimensionConstrain createMaxDimension(int width, int height) {</div><div>      return createMaxDimension(width, height, false);</div><div>    }</div><div>  </div><div>    /**</div><div>     * Forces the image to keep radio and be keeped within the width and height.</div><div>     *</div><div>     * @param width</div><div>     * @param height</div><div>     * @param neverEnlargeImage if true only a downscale will occour</div><div>     * @return</div><div>     */</div><div>    public static DimensionConstrain createMaxDimension(</div><div>        final int width, final int height, final boolean neverEnlargeImage) {</div><div>      assert width &gt; 0 &amp;&amp; height &gt; 0 : &quot;Dimension must be larger that 0&quot;;</div><div>      final double scaleFactor = width / (double) height;</div><div>      return new DimensionConstrain() {</div><div>        public Dimension getDimension(Dimension dimension) {</div><div>          double srcScaleFactor = dimension.width / (double) dimension.height;</div><div>          double scale;</div><div>          if (srcScaleFactor &gt; scaleFactor) {</div><div>            scale = width / (double) dimension.width;</div><div>          } else {</div><div>            scale = height / (double) dimension.height;</div><div>          }</div><div>          if (neverEnlargeImage) {</div><div>            scale = Math.min(scale, 1);</div><div>          }</div><div>          int dstWidth = (int) Math.round(dimension.width * scale);</div><div>          int dstHeight = (int) Math.round(dimension.height * scale);</div><div>          return new Dimension(dstWidth, dstHeight);</div><div>        }</div><div>      };</div><div>    }</div><div>  </div><div>    /**</div><div>     * Forces the image to keep radio and be keeped within the width and height. Width and height are</div><div>     * defined (length1 x length2) or (length2 x length1).</div><div>     *</div><div>     * &lt;p&gt;This is usefull is the scaling allow a certain format (such as 16x9&quot;) but allow the</div><div>     * dimension to be rotated 90 degrees (so also 9x16&quot; is allowed).</div><div>     *</div><div>     * @param length1</div><div>     * @param length2</div><div>     * @return</div><div>     */</div><div>    public static DimensionConstrain createMaxDimensionNoOrientation(int length1, int length2) {</div><div>      return createMaxDimensionNoOrientation(length1, length2, false);</div><div>    }</div><div>  </div><div>    /**</div><div>     * Forces the image to keep radio and be keeped within the width and height. Width and height are</div><div>     * defined (length1 x length2) or (length2 x length1).</div><div>     *</div><div>     * &lt;p&gt;This is usefull is the scaling allow a certain format (such as 16x9&quot;) but allow the</div><div>     * dimension to be rotated 90 degrees (so also 9x16&quot; is allowed).</div><div>     *</div><div>     * @param length1</div><div>     * @param length2</div><div>     * @param neverEnlargeImage if true only a downscale will occour</div><div>     * @return</div><div>     */</div><div>    public static DimensionConstrain createMaxDimensionNoOrientation(</div><div>        final int length1, final int length2, final boolean neverEnlargeImage) {</div><div>      assert length1 &gt; 0 &amp;&amp; length2 &gt; 0 : &quot;Dimension must be larger that 0&quot;;</div><div>      final double scaleFactor = length1 / (double) length2;</div><div>      return new DimensionConstrain() {</div><div>        public Dimension getDimension(Dimension dimension) {</div><div>          double srcScaleFactor = dimension.width / (double) dimension.height;</div><div>          int width;</div><div>          int height;</div><div>          // swap length1 and length2</div><div>          if (srcScaleFactor &gt; scaleFactor) {</div><div>            width = length1;</div><div>            height = length2;</div><div>          } else {</div><div>            width = length2;</div><div>            height = length1;</div><div>          }</div><div>  </div><div>          final double scaleFactor = width / (double) height;</div><div>          double scale;</div><div>          if (srcScaleFactor &gt; scaleFactor) {</div><div>            scale = width / (double) dimension.width;</div><div>          } else {</div><div>            scale = height / (double) dimension.height;</div><div>          }</div><div>          if (neverEnlargeImage) {</div><div>            scale = Math.min(scale, 1);</div><div>          }</div><div>          int dstWidth = (int) Math.round(dimension.width * scale);</div><div>          int dstHeight = (int) Math.round(dimension.height * scale);</div><div>          return new Dimension(dstWidth, dstHeight);</div><div>        }</div><div>      };</div><div>    }</div><div>  }</div></code></pre></body></html>