<html><body style="font-size:16px;width:1000px;"><pre><code><div> /*</div><div>  *  Copyright 2016 Patrick Favre-Bulle</div><div>  *</div><div>  *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</div><div>  *  you may not use this file except in compliance with the License.</div><div>  *  You may obtain a copy of the License at</div><div>  *</div><div>  *      http://www.apache.org/licenses/LICENSE-2.0</div><div>  *</div><div>  * Unless required by applicable law or agreed to in writing, software</div><div>  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</div><div>  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</div><div>  * See the License for the specific language governing permissions and</div><div>  * limitations under the License.</div><div>  */</div><div> </div><div> package at.favre.tools.dconvert.converters.scaling;</div><div> </div><div> import com.mortennobel.imagescaling.*;</div><div> import org.imgscalr.Scalr;</div><div> </div><div> import java.awt.*;</div><div> import java.awt.image.BufferedImage;</div><div> </div><div> /** A best of of progressive scaling algorithms from different libs */</div><div> public class ProgressiveAlgorithm implements ScaleAlgorithm {</div><div>   public Type type;</div><div> </div><div>   public ProgressiveAlgorithm(Type type) {</div><div>     this.type = type;</div><div>   }</div><div> </div><div>   @Override</div><div>   public BufferedImage scale(BufferedImage imageToScale, int dWidth, int dHeight) {</div><div>     switch (type) {</div><div>       case NOBEL_BILINEAR:</div><div style="background-color:MediumSpringGreen;">         return new MultiStepRescaleOp(dWidth, dHeight, RenderingHints.VALUE_INTERPOLATION_BILINEAR)</div><div style="background-color:MediumSpringGreen;">             .filter(imageToScale, null);</div><div>       case NOBEL_BICUBUC:</div><div style="background-color:MediumSpringGreen;">         return new MultiStepRescaleOp(dWidth, dHeight, RenderingHints.VALUE_INTERPOLATION_BICUBIC)</div><div style="background-color:MediumSpringGreen;">             .filter(imageToScale, null);</div><div>       case NOBEL_NEAREST_NEIGHBOR:</div><div style="background-color:MediumSpringGreen;">         return new MultiStepRescaleOp(</div><div>                 dWidth, dHeight, RenderingHints.VALUE_INTERPOLATION_NEAREST_NEIGHBOR)</div><div style="background-color:MediumSpringGreen;">             .filter(imageToScale, null);</div><div>       case NOBEL_LANCZOS3:</div><div style="background-color:MediumSpringGreen;">         return new MultiStepLanczos3RescaleOp(dWidth, dHeight).filter(imageToScale, null);</div><div>       case PROGRESSIVE_BILINEAR_AND_LANCZOS2:</div><div style="background-color:MediumSpringGreen;">         return scaleProgressiveLanczos(imageToScale, dWidth, dHeight, 2);</div><div>       case PROGRESSIVE_BILINEAR_AND_LANCZOS3:</div><div style="background-color:MediumSpringGreen;">         return scaleProgressiveLanczos(imageToScale, dWidth, dHeight, 3);</div><div>       case THUMBNAILATOR_BILINEAR:</div><div style="background-color:MediumSpringGreen;">         return new ThumbnailnatorProgressiveAlgorithm(RenderingHints.VALUE_INTERPOLATION_BILINEAR)</div><div style="background-color:MediumSpringGreen;">             .scale(imageToScale, dWidth, dHeight);</div><div>       case THUMBNAILATOR_BICUBUC:</div><div style="background-color:MediumSpringGreen;">         return new ThumbnailnatorProgressiveAlgorithm(RenderingHints.VALUE_INTERPOLATION_BICUBIC)</div><div style="background-color:MediumSpringGreen;">             .scale(imageToScale, dWidth, dHeight);</div><div>       case IMGSCALR_SEVENTH_STEP:</div><div style="background-color:MediumSpringGreen;">         return Scalr.resize(</div><div>             imageToScale, Scalr.Method.ULTRA_QUALITY, Scalr.Mode.FIT_EXACT, dWidth, dHeight, null);</div><div>       case IMGSCALR_HALF_STEP:</div><div style="background-color:MediumSpringGreen;">         return Scalr.resize(</div><div>             imageToScale, Scalr.Method.QUALITY, Scalr.Mode.FIT_EXACT, dWidth, dHeight, null);</div><div>       default:</div><div>         throw new IllegalArgumentException(&quot;unknown algorithm&quot;);</div><div>     }</div><div>   }</div><div> </div><div>   private BufferedImage scaleProgressiveLanczos(</div><div>       BufferedImage imageToScale, int dstWidth, int dstHeight, float radius) {</div><div>     if (dstWidth &lt; (imageToScale.getWidth() / 2) &amp;&amp; dstHeight &lt; (imageToScale.getHeight() / 2)) {</div><div style="background-color:MediumSpringGreen;">       return new ThumbnailnatorProgressiveAlgorithm(RenderingHints.VALUE_INTERPOLATION_BILINEAR)</div><div style="background-color:MediumSpringGreen;">           .scale(imageToScale, dstWidth, dstHeight);</div><div>     } else {</div><div>       return new ResampleAlgorithm(new ResampleAlgorithm.LanczosFilter(radius))</div><div style="background-color:MediumSpringGreen;">           .scale(imageToScale, dstWidth, dstHeight);</div><div>     }</div><div>   }</div><div> </div><div>   @Override</div><div>   public String toString() {</div><div style="background-color:MediumSpringGreen;">     return &quot;ProgressiveAlgorithm[&quot; + type + &#x27;]&#x27;;</div><div>   }</div><div> </div><div>   @Override</div><div>   public boolean equals(Object o) {</div><div>     if (this == o) return true;</div><div style="background-color:MediumSpringGreen;">     if (o == null || getClass() != o.getClass()) return false;</div><div> </div><div>     ProgressiveAlgorithm that = (ProgressiveAlgorithm) o;</div><div> </div><div>     return type == that.type;</div><div>   }</div><div> </div><div>   @Override</div><div>   public int hashCode() {</div><div style="background-color:MediumSpringGreen;">     return type != null ? type.hashCode() : 0;</div><div>   }</div><div> </div><div>   public enum Type {</div><div>     /** Algorithms from https://github.com/mortennobel/java-image-scaling */</div><div>     NOBEL_BILINEAR,</div><div>     NOBEL_BICUBUC,</div><div>     NOBEL_NEAREST_NEIGHBOR,</div><div>     NOBEL_LANCZOS3,</div><div>     /** Algorithms from https://github.com/coobird/thumbnailator */</div><div>     THUMBNAILATOR_BILINEAR,</div><div>     THUMBNAILATOR_BICUBUC,</div><div>     /** Algorithms from https://github.com/thebuzzmedia/imgscalr */</div><div>     IMGSCALR_SEVENTH_STEP,</div><div>     IMGSCALR_HALF_STEP,</div><div>     /** Combination of bilinear with lanczos3, uses bilinear if target is at least half of src */</div><div>     PROGRESSIVE_BILINEAR_AND_LANCZOS2,</div><div>     PROGRESSIVE_BILINEAR_AND_LANCZOS3</div><div>   }</div><div> </div><div style="background-color:MediumSpringGreen;">   private final class MultiStepLanczos3RescaleOp extends AdvancedResizeOp {</div><div>     private MultiStepLanczos3RescaleOp(int dstWidth, int dstHeight) {</div><div style="background-color:MediumSpringGreen;">       super(DimensionConstrain.createAbsolutionDimension(dstWidth, dstHeight));</div><div>     }</div><div> </div><div>     public BufferedImage doFilter(</div><div>         BufferedImage img, BufferedImage dest, int dstWidth, int dstHeight) {</div><div>       BufferedImage ret = img;</div><div>       int w, h;</div><div> </div><div style="background-color:MediumSpringGreen;">       w = img.getWidth();</div><div style="background-color:MediumSpringGreen;">       h = img.getHeight();</div><div> </div><div>       do {</div><div>         if (w &gt; dstWidth) {</div><div style="background-color:MediumSpringGreen;">           w /= 2;</div><div>           if (w &lt; dstWidth) {</div><div>             w = dstWidth;</div><div>           }</div><div>         } else {</div><div>           w = dstWidth;</div><div>         }</div><div> </div><div>         if (h &gt; dstHeight) {</div><div style="background-color:MediumSpringGreen;">           h /= 2;</div><div>           if (h &lt; dstHeight) {</div><div>             h = dstHeight;</div><div>           }</div><div>         } else {</div><div>           h = dstHeight;</div><div>         }</div><div> </div><div style="background-color:MediumSpringGreen;">         ResampleOp resizeOp = new ResampleOp(w, h);</div><div>         resizeOp.setFilter(ResampleFilters.getLanczos3Filter());</div><div style="background-color:MediumSpringGreen;">         ret = resizeOp.filter(ret, null);</div><div>       } while (w != dstWidth || h != dstHeight);</div><div> </div><div>       return ret;</div><div>     }</div><div>   }</div><div> }</div></code></pre></body></html>