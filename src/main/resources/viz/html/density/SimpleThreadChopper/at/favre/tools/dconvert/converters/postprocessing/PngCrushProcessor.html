<html><body style="font-size:16px;width:1000px;"><pre><code><div> /*</div><div>  *  Copyright 2016 Patrick Favre-Bulle</div><div>  *</div><div>  *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</div><div>  *  you may not use this file except in compliance with the License.</div><div>  *  You may obtain a copy of the License at</div><div>  *</div><div>  *      http://www.apache.org/licenses/LICENSE-2.0</div><div>  *</div><div>  * Unless required by applicable law or agreed to in writing, software</div><div>  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</div><div>  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</div><div>  * See the License for the specific language governing permissions and</div><div>  * limitations under the License.</div><div>  */</div><div> </div><div> package at.favre.tools.dconvert.converters.postprocessing;</div><div> </div><div> import at.favre.tools.dconvert.arg.ImageType;</div><div> import at.favre.tools.dconvert.converters.Result;</div><div> import at.favre.tools.dconvert.util.MiscUtil;</div><div> import at.favre.tools.dconvert.util.PostProcessorUtil;</div><div> </div><div> import java.io.File;</div><div> import java.util.Collections;</div><div> </div><div> /** Calls pngcrush on a file */</div><div> public class PngCrushProcessor extends APostProcessor {</div><div>   private static final String[] DEFAULT_ARGS =</div><div>       new String[] {</div><div>         &quot;-rem&quot;, &quot;alla&quot;, &quot;-rem&quot;, &quot;text&quot;, &quot;-rem&quot;, &quot;gAMA&quot;, &quot;-rem&quot;, &quot;cHRM&quot;, &quot;-rem&quot;, &quot;iCCP&quot;, &quot;-rem&quot;,</div><div>         &quot;sRGB&quot;</div><div>       };</div><div>   private final String[] additionalArgs;</div><div> </div><div>   public PngCrushProcessor() {</div><div>     this(DEFAULT_ARGS);</div><div>   }</div><div> </div><div>   public PngCrushProcessor(String[] additionalArgs) {</div><div>     this.additionalArgs = additionalArgs;</div><div>   }</div><div> </div><div>   @Override</div><div>   public Result synchronizedProcess(File rawFile, boolean keepOriginal) {</div><div>     try {</div><div style="background-color:MediumSpringGreen;">       String[] args =</div><div style="background-color:MediumSpringGreen;">           MiscUtil.concat(</div><div style="background-color:MediumSpringGreen;">               MiscUtil.concat(new String[] {&quot;pngcrush&quot;}, additionalArgs),</div><div>               new String[] {&quot;%%sourceFilePath%%&quot;, &quot;%%outFilePath%%&quot;});</div><div>       return PostProcessorUtil.runImageOptimizer(rawFile, ImageType.PNG, args, keepOriginal);</div><div>     } catch (Exception e) {</div><div>       return new Result(</div><div>           &quot;could not execute post processor &quot; + getClass().getSimpleName(),</div><div>           e,</div><div>           Collections.singletonList(rawFile));</div><div>     }</div><div>   }</div><div> </div><div>   @Override</div><div>   public boolean isSupported() {</div><div style="background-color:MediumSpringGreen;">     return PostProcessorUtil.canRunCmd(new String[] {&quot;pngcrush&quot;, &quot;-h&quot;});</div><div>   }</div><div> }</div></code></pre></body></html>