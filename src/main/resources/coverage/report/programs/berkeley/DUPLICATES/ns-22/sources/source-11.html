


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > Protocol</title>
  <style type="text/css">
    @import "../../.css/coverage.css";
    @import "../../.css/highlight-idea.css";
  </style>
  <script type="text/javascript" src="../../.js/highlight.pack.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.sleepycat.je.rep.stream</a>
</div>

<h1>Coverage Summary for Class: Protocol (com.sleepycat.je.rep.stream)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">Protocol</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/70)
  </span>
</td>
</tr>
  <tr>
    <td class="name">Protocol$DuplicateNodeReject</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Protocol$FeederJEVersions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/15)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Protocol$FeederProtocolVersion</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Protocol$JEVersions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Protocol$JEVersionsReject</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Protocol$NodeGroupInfo</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/46)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Protocol$NodeGroupInfoOK</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Protocol$NodeGroupInfoReject</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Protocol$ReAuthenticate</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Protocol$ReplicaJEVersions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Protocol$ReplicaProtocolVersion</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Protocol$SNTPRequest</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Protocol$SNTPResponse</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/11)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/24)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/87)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/233)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<div class="sourceCode" id="sourceCode"><i class="no-highlight">1</i>&nbsp;/*-
<i class="no-highlight">2</i>&nbsp; * Copyright (C) 2002, 2017, Oracle and/or its affiliates. All rights reserved.
<i class="no-highlight">3</i>&nbsp; *
<i class="no-highlight">4</i>&nbsp; * This file was distributed by Oracle as part of a version of Oracle Berkeley
<i class="no-highlight">5</i>&nbsp; * DB Java Edition made available at:
<i class="no-highlight">6</i>&nbsp; *
<i class="no-highlight">7</i>&nbsp; * http://www.oracle.com/technetwork/database/database-technologies/berkeleydb/downloads/index.html
<i class="no-highlight">8</i>&nbsp; *
<i class="no-highlight">9</i>&nbsp; * Please see the LICENSE file included in the top-level directory of the
<i class="no-highlight">10</i>&nbsp; * appropriate version of Oracle Berkeley DB Java Edition for a copy of the
<i class="no-highlight">11</i>&nbsp; * license and additional information.
<i class="no-highlight">12</i>&nbsp; */
<i class="no-highlight">13</i>&nbsp;
<i class="no-highlight">14</i>&nbsp;package com.sleepycat.je.rep.stream;
<i class="no-highlight">15</i>&nbsp;
<i class="no-highlight">16</i>&nbsp;import java.nio.ByteBuffer;
<i class="no-highlight">17</i>&nbsp;import java.util.UUID;
<i class="no-highlight">18</i>&nbsp;
<i class="no-highlight">19</i>&nbsp;import com.sleepycat.je.JEVersion;
<i class="no-highlight">20</i>&nbsp;import com.sleepycat.je.log.LogEntryType;
<i class="no-highlight">21</i>&nbsp;import com.sleepycat.je.log.LogUtils;
<i class="no-highlight">22</i>&nbsp;import com.sleepycat.je.rep.NodeType;
<i class="no-highlight">23</i>&nbsp;import com.sleepycat.je.rep.impl.RepGroupImpl;
<i class="no-highlight">24</i>&nbsp;import com.sleepycat.je.rep.impl.RepImpl;
<i class="no-highlight">25</i>&nbsp;import com.sleepycat.je.rep.impl.node.NameIdPair;
<i class="no-highlight">26</i>&nbsp;import com.sleepycat.je.rep.impl.node.RepNode;
<i class="no-highlight">27</i>&nbsp;import com.sleepycat.je.rep.utilint.RepUtils.Clock;
<i class="no-highlight">28</i>&nbsp;
<i class="no-highlight">29</i>&nbsp;/**
<i class="no-highlight">30</i>&nbsp; * Defines the messages used to set up a feeder-replica replication stream.
<i class="no-highlight">31</i>&nbsp; *
<i class="no-highlight">32</i>&nbsp; * Note: this protocol is an extension of je.rep.stream.BaseProtocol, which
<i class="no-highlight">33</i>&nbsp; * defines a set of basic message operation codes that are to be used by
<i class="no-highlight">34</i>&nbsp; * its subclasses.
<i class="no-highlight">35</i>&nbsp; *
<i class="no-highlight">36</i>&nbsp; * From Feeder to Replica
<i class="no-highlight">37</i>&nbsp; *
<i class="no-highlight">38</i>&nbsp; *    Heartbeat -&gt; HeartbeatResponse
<i class="no-highlight">39</i>&nbsp; *    Commit -&gt; Ack
<i class="no-highlight">40</i>&nbsp; *    Commit+ -&gt; GroupAck
<i class="no-highlight">41</i>&nbsp; *    Entry
<i class="no-highlight">42</i>&nbsp; *    ShutdownRequest -&gt; ShutdownResponse
<i class="no-highlight">43</i>&nbsp; *
<i class="no-highlight">44</i>&nbsp; * Note: in the future, we may want to support bulk entry messages
<i class="no-highlight">45</i>&nbsp; *
<i class="no-highlight">46</i>&nbsp; * From Replica to Feeder
<i class="no-highlight">47</i>&nbsp; *
<i class="no-highlight">48</i>&nbsp; * The following subset of messages represents the handshake protocol that
<i class="no-highlight">49</i>&nbsp; * precedes the transmission of replication log entries.
<i class="no-highlight">50</i>&nbsp; *
<i class="no-highlight">51</i>&nbsp; *    ReplicaProtocolVersion -&gt; FeederProtocolVersion | DuplicateNodeReject
<i class="no-highlight">52</i>&nbsp; *    ReplicaJEVersions -&gt; FeederJEVersions | JEVersionsReject
<i class="no-highlight">53</i>&nbsp; *    NodeGroupInfo -&gt; NodeGroupInfoOK | NodeGroupInfoReject
<i class="no-highlight">54</i>&nbsp; *    SNTPRequest -&gt; SNTPResponse
<i class="no-highlight">55</i>&nbsp; *    -&gt; HeartbeatResponse
<i class="no-highlight">56</i>&nbsp; *
<i class="no-highlight">57</i>&nbsp; * A HeartbeatResponse is not strictly a response message and may also be sent
<i class="no-highlight">58</i>&nbsp; * spontaneously if there is no output activity in a heartbeat interval. This
<i class="no-highlight">59</i>&nbsp; * spontaneous generation of a HeartbeatReponse ensures that a socket is not
<i class="no-highlight">60</i>&nbsp; * timed out if the feeder or the replica replay are otherwise busy.
<i class="no-highlight">61</i>&nbsp; *
<i class="no-highlight">62</i>&nbsp; * Note that there may be multiple SNTPRequest/SNTPResponse message pairs that
<i class="no-highlight">63</i>&nbsp; * are exchanged as part of a single handshake. So a successful handshake
<i class="no-highlight">64</i>&nbsp; * requested sequence generated by the Replica looks like:
<i class="no-highlight">65</i>&nbsp; *
<i class="no-highlight">66</i>&nbsp; * ReplicaProtocolVersion ReplicaJEVersions MembershipInfo [SNTPRequest]+
<i class="no-highlight">67</i>&nbsp; *
<i class="no-highlight">68</i>&nbsp; * The following messages constitute the syncup and the transmission of log
<i class="no-highlight">69</i>&nbsp; * entries.
<i class="no-highlight">70</i>&nbsp; *
<i class="no-highlight">71</i>&nbsp; *    EntryRequest -&gt; Entry | EntryNotFound | AlternateMatchpoint
<i class="no-highlight">72</i>&nbsp; *    RestoreRequest -&gt; RestoreResponse
<i class="no-highlight">73</i>&nbsp; *    StartStream
<i class="no-highlight">74</i>&nbsp; *
<i class="no-highlight">75</i>&nbsp; * The Protocol instance has local state in terms of buffers that are reused
<i class="no-highlight">76</i>&nbsp; * across multiple messages. A Protocol instance is expected to be used in
<i class="no-highlight">77</i>&nbsp; * strictly serial fashion. Consequently, there is an instance for each Replica
<i class="no-highlight">78</i>&nbsp; * to Feeder connection, and two instances per Feeder to Replica connection:
<i class="no-highlight">79</i>&nbsp; * one for the InputThread and one for the OutputThread.
<i class="no-highlight">80</i>&nbsp; */
<b class="nc"><i class="no-highlight">81</i>&nbsp;public class Protocol extends BaseProtocol {</b>
<i class="no-highlight">82</i>&nbsp;
<i class="no-highlight">83</i>&nbsp;    /**
<i class="no-highlight">84</i>&nbsp;     * Normally the op code should fall in the range defined in BaseProtocol,
<i class="no-highlight">85</i>&nbsp;     * however following op code inherit from original implementation of
<i class="no-highlight">86</i>&nbsp;     * stream protocol thus we just copy them here for backward compatibility.
<i class="no-highlight">87</i>&nbsp;     */
<b class="nc"><i class="no-highlight">88</i>&nbsp;    public final static MessageOp REPLICA_PROTOCOL_VERSION =</b>
<i class="no-highlight">89</i>&nbsp;        new MessageOp((short) 1, ReplicaProtocolVersion.class);
<i class="no-highlight">90</i>&nbsp;
<b class="nc"><i class="no-highlight">91</i>&nbsp;    public final static MessageOp FEEDER_PROTOCOL_VERSION =</b>
<i class="no-highlight">92</i>&nbsp;        new MessageOp((short) 2, FeederProtocolVersion.class);
<i class="no-highlight">93</i>&nbsp;
<b class="nc"><i class="no-highlight">94</i>&nbsp;    public final static MessageOp DUP_NODE_REJECT =</b>
<i class="no-highlight">95</i>&nbsp;        new MessageOp((short) 3, DuplicateNodeReject.class);
<i class="no-highlight">96</i>&nbsp;
<b class="nc"><i class="no-highlight">97</i>&nbsp;    public final static MessageOp REPLICA_JE_VERSIONS =</b>
<i class="no-highlight">98</i>&nbsp;        new MessageOp((short) 4, ReplicaJEVersions.class);
<i class="no-highlight">99</i>&nbsp;
<b class="nc"><i class="no-highlight">100</i>&nbsp;    public final static MessageOp FEEDER_JE_VERSIONS =</b>
<i class="no-highlight">101</i>&nbsp;        new MessageOp((short) 5, FeederJEVersions.class);
<i class="no-highlight">102</i>&nbsp;
<b class="nc"><i class="no-highlight">103</i>&nbsp;    public final static MessageOp JE_VERSIONS_REJECT =</b>
<i class="no-highlight">104</i>&nbsp;        new MessageOp((short) 6, JEVersionsReject.class);
<i class="no-highlight">105</i>&nbsp;
<b class="nc"><i class="no-highlight">106</i>&nbsp;    public final static MessageOp MEMBERSHIP_INFO =</b>
<i class="no-highlight">107</i>&nbsp;        new MessageOp((short) 7, NodeGroupInfo.class);
<i class="no-highlight">108</i>&nbsp;
<b class="nc"><i class="no-highlight">109</i>&nbsp;    public final static MessageOp MEMBERSHIP_INFO_OK =</b>
<i class="no-highlight">110</i>&nbsp;        new MessageOp((short) 8, NodeGroupInfoOK.class);
<i class="no-highlight">111</i>&nbsp;
<b class="nc"><i class="no-highlight">112</i>&nbsp;    public final static MessageOp MEMBERSHIP_INFO_REJECT =</b>
<i class="no-highlight">113</i>&nbsp;        new MessageOp((short) 9, NodeGroupInfoReject.class);
<i class="no-highlight">114</i>&nbsp;
<b class="nc"><i class="no-highlight">115</i>&nbsp;    public final static MessageOp SNTP_REQUEST =</b>
<i class="no-highlight">116</i>&nbsp;        new MessageOp((short)10, SNTPRequest.class);
<i class="no-highlight">117</i>&nbsp;
<b class="nc"><i class="no-highlight">118</i>&nbsp;    public final static MessageOp SNTP_RESPONSE =</b>
<i class="no-highlight">119</i>&nbsp;        new MessageOp((short)11, SNTPResponse.class);
<i class="no-highlight">120</i>&nbsp;
<b class="nc"><i class="no-highlight">121</i>&nbsp;    public final static MessageOp REAUTHENTICATE =</b>
<i class="no-highlight">122</i>&nbsp;        new MessageOp((short)12, ReAuthenticate.class);
<i class="no-highlight">123</i>&nbsp;
<i class="no-highlight">124</i>&nbsp;    /** All message ops needed by protocol */
<b class="nc"><i class="no-highlight">125</i>&nbsp;    private static final MessageOp[] ALL_MESSAGE_OPS = {</b>
<i class="no-highlight">126</i>&nbsp;        REPLICA_PROTOCOL_VERSION,
<i class="no-highlight">127</i>&nbsp;        FEEDER_PROTOCOL_VERSION,
<i class="no-highlight">128</i>&nbsp;        DUP_NODE_REJECT,
<i class="no-highlight">129</i>&nbsp;        REPLICA_JE_VERSIONS,
<i class="no-highlight">130</i>&nbsp;        FEEDER_JE_VERSIONS,
<i class="no-highlight">131</i>&nbsp;        JE_VERSIONS_REJECT,
<i class="no-highlight">132</i>&nbsp;        MEMBERSHIP_INFO,
<i class="no-highlight">133</i>&nbsp;        MEMBERSHIP_INFO_OK,
<i class="no-highlight">134</i>&nbsp;        MEMBERSHIP_INFO_REJECT,
<i class="no-highlight">135</i>&nbsp;        SNTP_REQUEST,
<i class="no-highlight">136</i>&nbsp;        SNTP_RESPONSE,
<i class="no-highlight">137</i>&nbsp;        ENTRY,
<i class="no-highlight">138</i>&nbsp;        START_STREAM,
<i class="no-highlight">139</i>&nbsp;        HEARTBEAT,
<i class="no-highlight">140</i>&nbsp;        HEARTBEAT_RESPONSE,
<i class="no-highlight">141</i>&nbsp;        COMMIT,
<i class="no-highlight">142</i>&nbsp;        ACK,
<i class="no-highlight">143</i>&nbsp;        ENTRY_REQUEST,
<i class="no-highlight">144</i>&nbsp;        ENTRY_NOTFOUND,
<i class="no-highlight">145</i>&nbsp;        RESTORE_REQUEST,
<i class="no-highlight">146</i>&nbsp;        RESTORE_RESPONSE,
<i class="no-highlight">147</i>&nbsp;        ALT_MATCHPOINT,
<i class="no-highlight">148</i>&nbsp;        SHUTDOWN_REQUEST,
<i class="no-highlight">149</i>&nbsp;        SHUTDOWN_RESPONSE,
<i class="no-highlight">150</i>&nbsp;        GROUP_ACK,
<i class="no-highlight">151</i>&nbsp;        REAUTHENTICATE
<i class="no-highlight">152</i>&nbsp;    };
<i class="no-highlight">153</i>&nbsp;
<i class="no-highlight">154</i>&nbsp;    private final Clock clock;
<i class="no-highlight">155</i>&nbsp;
<i class="no-highlight">156</i>&nbsp;    /**
<i class="no-highlight">157</i>&nbsp;     * Returns a Protocol object configured that implements the specified
<i class="no-highlight">158</i>&nbsp;     * (supported) protocol version.
<i class="no-highlight">159</i>&nbsp;     *
<i class="no-highlight">160</i>&nbsp;     * @param repImpl the node using the protocol
<i class="no-highlight">161</i>&nbsp;     *
<i class="no-highlight">162</i>&nbsp;     * @param nameIdPair name-id pair of the node using the protocol
<i class="no-highlight">163</i>&nbsp;     *
<i class="no-highlight">164</i>&nbsp;     * @param clock clock used by the node
<i class="no-highlight">165</i>&nbsp;     *
<i class="no-highlight">166</i>&nbsp;     * @param protocolVersion the version of the protocol that must be
<i class="no-highlight">167</i>&nbsp;     *        implemented by this object
<i class="no-highlight">168</i>&nbsp;     *
<i class="no-highlight">169</i>&nbsp;     * @param maxProtocolVersion the highest supported protocol version, which
<i class="no-highlight">170</i>&nbsp;     *        may be lower than the code version, for testing purposes
<i class="no-highlight">171</i>&nbsp;     *
<i class="no-highlight">172</i>&nbsp;     * @param streamLogVersion the log version of the format used to write log
<i class="no-highlight">173</i>&nbsp;     *        entries
<i class="no-highlight">174</i>&nbsp;     */
<i class="no-highlight">175</i>&nbsp;    private Protocol(final RepImpl repImpl,
<i class="no-highlight">176</i>&nbsp;                     final NameIdPair nameIdPair,
<i class="no-highlight">177</i>&nbsp;                     final Clock clock,
<i class="no-highlight">178</i>&nbsp;                     final int protocolVersion,
<i class="no-highlight">179</i>&nbsp;                     final int maxProtocolVersion,
<i class="no-highlight">180</i>&nbsp;                     final int streamLogVersion,
<i class="no-highlight">181</i>&nbsp;                     @SuppressWarnings(&quot;unused&quot;)
<i class="no-highlight">182</i>&nbsp;                     final int groupFormatVersion) {
<i class="no-highlight">183</i>&nbsp;
<b class="nc"><i class="no-highlight">184</i>&nbsp;        super(repImpl, nameIdPair, protocolVersion, maxProtocolVersion,</b>
<i class="no-highlight">185</i>&nbsp;              streamLogVersion, ALL_MESSAGE_OPS,
<i class="no-highlight">186</i>&nbsp;              /* no validity check, from legacy protocol */
<i class="no-highlight">187</i>&nbsp;              false);
<i class="no-highlight">188</i>&nbsp;
<b class="nc"><i class="no-highlight">189</i>&nbsp;        this.configuredVersion = protocolVersion;</b>
<b class="nc"><i class="no-highlight">190</i>&nbsp;        this.clock = clock;</b>
<i class="no-highlight">191</i>&nbsp;    }
<i class="no-highlight">192</i>&nbsp;
<i class="no-highlight">193</i>&nbsp;    /**
<i class="no-highlight">194</i>&nbsp;     * Returns a protocol object that supports the specific requested protocol
<i class="no-highlight">195</i>&nbsp;     * version, which must not be higher than the specified maximum version, or
<i class="no-highlight">196</i>&nbsp;     * null if no such version is supported.
<i class="no-highlight">197</i>&nbsp;     */
<i class="no-highlight">198</i>&nbsp;    public static Protocol get(final RepNode repNode,
<i class="no-highlight">199</i>&nbsp;            final int protocolVersion,
<i class="no-highlight">200</i>&nbsp;            final int maxProtocolVersion) {
<b class="nc"><i class="no-highlight">201</i>&nbsp;         return get(repNode.getRepImpl(),</b>
<b class="nc"><i class="no-highlight">202</i>&nbsp;                    repNode.getNameIdPair(),</b>
<b class="nc"><i class="no-highlight">203</i>&nbsp;                    repNode.getClock(),</b>
<i class="no-highlight">204</i>&nbsp;                    protocolVersion,
<i class="no-highlight">205</i>&nbsp;                    maxProtocolVersion,
<b class="nc"><i class="no-highlight">206</i>&nbsp;                    repNode.getGroup().getFormatVersion());</b>
<i class="no-highlight">207</i>&nbsp;    }
<i class="no-highlight">208</i>&nbsp;
<i class="no-highlight">209</i>&nbsp;    public static Protocol get(final RepImpl repImpl,
<i class="no-highlight">210</i>&nbsp;                               final NameIdPair nameIdPair,
<i class="no-highlight">211</i>&nbsp;                               final Clock clock,
<i class="no-highlight">212</i>&nbsp;                               final int protocolVersion,
<i class="no-highlight">213</i>&nbsp;                               final int maxProtocolVersion,
<i class="no-highlight">214</i>&nbsp;                               final int groupFormatVersion) {
<b class="nc"><i class="no-highlight">215</i>&nbsp;        return get(repImpl, nameIdPair, clock,</b>
<i class="no-highlight">216</i>&nbsp;                   protocolVersion, maxProtocolVersion,
<i class="no-highlight">217</i>&nbsp;                   LogEntryType.LOG_VERSION, groupFormatVersion);
<i class="no-highlight">218</i>&nbsp;    }
<i class="no-highlight">219</i>&nbsp;
<i class="no-highlight">220</i>&nbsp;    /**
<i class="no-highlight">221</i>&nbsp;     * Returns a protocol object that supports the specified protocol, which
<i class="no-highlight">222</i>&nbsp;     * must be less than the specified maximum version, and writes log entries
<i class="no-highlight">223</i>&nbsp;     * in the specified log version format.  Returns null if no such version is
<i class="no-highlight">224</i>&nbsp;     * supported.
<i class="no-highlight">225</i>&nbsp;     */
<i class="no-highlight">226</i>&nbsp;    public static Protocol get(final RepNode repNode,
<i class="no-highlight">227</i>&nbsp;            final int protocolVersion,
<i class="no-highlight">228</i>&nbsp;            final int maxProtocolVersion,
<i class="no-highlight">229</i>&nbsp;            final int streamLogVersion) {
<b class="nc"><i class="no-highlight">230</i>&nbsp;        return get(repNode.getRepImpl(),</b>
<b class="nc"><i class="no-highlight">231</i>&nbsp;                   repNode.getNameIdPair(),</b>
<b class="nc"><i class="no-highlight">232</i>&nbsp;                   repNode.getClock(),</b>
<i class="no-highlight">233</i>&nbsp;                   protocolVersion,
<i class="no-highlight">234</i>&nbsp;                   maxProtocolVersion,
<i class="no-highlight">235</i>&nbsp;                   streamLogVersion,
<b class="nc"><i class="no-highlight">236</i>&nbsp;                   repNode.getGroup().getFormatVersion());</b>
<i class="no-highlight">237</i>&nbsp;
<i class="no-highlight">238</i>&nbsp;    }
<i class="no-highlight">239</i>&nbsp;    public static Protocol get(final RepImpl repImpl,
<i class="no-highlight">240</i>&nbsp;                               final NameIdPair nameIdPair,
<i class="no-highlight">241</i>&nbsp;                               final Clock clock,
<i class="no-highlight">242</i>&nbsp;                               final int protocolVersion,
<i class="no-highlight">243</i>&nbsp;                               final int maxProtocolVersion,
<i class="no-highlight">244</i>&nbsp;                               final int streamLogVersion,
<i class="no-highlight">245</i>&nbsp;                               final int groupFormatVersion) {
<i class="no-highlight">246</i>&nbsp;
<i class="no-highlight">247</i>&nbsp;        /*
<i class="no-highlight">248</i>&nbsp;         * If the RepGroupImpl has been upgraded to version 3, then require
<i class="no-highlight">249</i>&nbsp;         * protocol version 5, which is required to support that RepGroupImpl
<i class="no-highlight">250</i>&nbsp;         * version.  This check prevents new facilities that depend on
<i class="no-highlight">251</i>&nbsp;         * RepGroupImpl version 3 from being seen by non-upgraded replicas.
<i class="no-highlight">252</i>&nbsp;         */
<b class="nc"><i class="no-highlight">253</i>&nbsp;        int minProtocolVersion = MIN_VERSION;</b>
<b class="nc"><i class="no-highlight">254</i>&nbsp;        if (groupFormatVersion &gt;= RepGroupImpl.FORMAT_VERSION_3) {</b>
<b class="nc"><i class="no-highlight">255</i>&nbsp;            minProtocolVersion = VERSION_5;</b>
<i class="no-highlight">256</i>&nbsp;        }
<i class="no-highlight">257</i>&nbsp;
<b class="nc"><i class="no-highlight">258</i>&nbsp;        return get(repImpl, nameIdPair, clock,</b>
<i class="no-highlight">259</i>&nbsp;                   protocolVersion, minProtocolVersion,
<i class="no-highlight">260</i>&nbsp;                   maxProtocolVersion, streamLogVersion, groupFormatVersion);
<i class="no-highlight">261</i>&nbsp;    }
<i class="no-highlight">262</i>&nbsp;
<i class="no-highlight">263</i>&nbsp;    /**
<i class="no-highlight">264</i>&nbsp;     * Returns a protocol object using the specified minimum and maximum
<i class="no-highlight">265</i>&nbsp;     * values, returning null if no supported version is found.  Use this
<i class="no-highlight">266</i>&nbsp;     * method for testing when the RepGroupImpl object is not available.
<i class="no-highlight">267</i>&nbsp;     */
<i class="no-highlight">268</i>&nbsp;    static Protocol get(final RepNode repNode,
<i class="no-highlight">269</i>&nbsp;            final int protocolVersion,
<i class="no-highlight">270</i>&nbsp;            final int minProtocolVersion,
<i class="no-highlight">271</i>&nbsp;            final int maxProtocolVersion,
<i class="no-highlight">272</i>&nbsp;            final int streamLogVersion) {
<b class="nc"><i class="no-highlight">273</i>&nbsp;        int formatVersion = RepGroupImpl.MAX_FORMAT_VERSION;</b>
<b class="nc"><i class="no-highlight">274</i>&nbsp;        if (repNode.getGroup() != null) {</b>
<b class="nc"><i class="no-highlight">275</i>&nbsp;            formatVersion = repNode.getGroup().getFormatVersion();</b>
<i class="no-highlight">276</i>&nbsp;        }
<i class="no-highlight">277</i>&nbsp;
<b class="nc"><i class="no-highlight">278</i>&nbsp;        return get(repNode.getRepImpl(),</b>
<b class="nc"><i class="no-highlight">279</i>&nbsp;                   repNode.getNameIdPair(),</b>
<b class="nc"><i class="no-highlight">280</i>&nbsp;                   repNode.getClock(),</b>
<i class="no-highlight">281</i>&nbsp;                   protocolVersion,
<i class="no-highlight">282</i>&nbsp;                   minProtocolVersion,
<i class="no-highlight">283</i>&nbsp;                   maxProtocolVersion,
<i class="no-highlight">284</i>&nbsp;                   streamLogVersion,
<i class="no-highlight">285</i>&nbsp;                   formatVersion);
<i class="no-highlight">286</i>&nbsp;    }
<i class="no-highlight">287</i>&nbsp;
<i class="no-highlight">288</i>&nbsp;    private static Protocol get(final RepImpl repImpl,
<i class="no-highlight">289</i>&nbsp;                                final NameIdPair nameIdPair,
<i class="no-highlight">290</i>&nbsp;                                final Clock clock,
<i class="no-highlight">291</i>&nbsp;                                final int protocolVersion,
<i class="no-highlight">292</i>&nbsp;                                final int minProtocolVersion,
<i class="no-highlight">293</i>&nbsp;                                final int maxProtocolVersion,
<i class="no-highlight">294</i>&nbsp;                                final int streamLogVersion,
<i class="no-highlight">295</i>&nbsp;                                final int groupFormatVersion) {
<i class="no-highlight">296</i>&nbsp;
<b class="nc"><i class="no-highlight">297</i>&nbsp;        if (!isSupportedVersion(protocolVersion, minProtocolVersion,</b>
<i class="no-highlight">298</i>&nbsp;                                maxProtocolVersion)) {
<b class="nc"><i class="no-highlight">299</i>&nbsp;            return null;</b>
<i class="no-highlight">300</i>&nbsp;        }
<i class="no-highlight">301</i>&nbsp;
<i class="no-highlight">302</i>&nbsp;        /*
<i class="no-highlight">303</i>&nbsp;         * Future code will do what is appropriate in support of the version
<i class="no-highlight">304</i>&nbsp;         * depending on the nature of the incompatibility.
<i class="no-highlight">305</i>&nbsp;         */
<b class="nc"><i class="no-highlight">306</i>&nbsp;        return new Protocol(repImpl, nameIdPair, clock,</b>
<i class="no-highlight">307</i>&nbsp;                            protocolVersion, maxProtocolVersion,
<i class="no-highlight">308</i>&nbsp;                            streamLogVersion, groupFormatVersion);
<i class="no-highlight">309</i>&nbsp;    }
<i class="no-highlight">310</i>&nbsp;
<i class="no-highlight">311</i>&nbsp;    /**
<i class="no-highlight">312</i>&nbsp;     * Returns a protocol object using the specified protocol version.
<i class="no-highlight">313</i>&nbsp;     */
<i class="no-highlight">314</i>&nbsp;    static Protocol getProtocol(final RepNode repNode,
<i class="no-highlight">315</i>&nbsp;                                final int protocolVersion) {
<b class="nc"><i class="no-highlight">316</i>&nbsp;        int formatVersion = RepGroupImpl.MAX_FORMAT_VERSION;</b>
<b class="nc"><i class="no-highlight">317</i>&nbsp;        if (repNode.getGroup() != null) {</b>
<b class="nc"><i class="no-highlight">318</i>&nbsp;            formatVersion = repNode.getGroup().getFormatVersion();</b>
<i class="no-highlight">319</i>&nbsp;        }
<i class="no-highlight">320</i>&nbsp;
<b class="nc"><i class="no-highlight">321</i>&nbsp;        return</b>
<b class="nc"><i class="no-highlight">322</i>&nbsp;        getProtocol(repNode.getRepImpl(),</b>
<b class="nc"><i class="no-highlight">323</i>&nbsp;                    repNode.getNameIdPair(),</b>
<b class="nc"><i class="no-highlight">324</i>&nbsp;                    repNode.getClock(),</b>
<i class="no-highlight">325</i>&nbsp;                    protocolVersion,
<i class="no-highlight">326</i>&nbsp;                    formatVersion);
<i class="no-highlight">327</i>&nbsp;    }
<i class="no-highlight">328</i>&nbsp;
<i class="no-highlight">329</i>&nbsp;    static Protocol getProtocol(final RepImpl repImpl,
<i class="no-highlight">330</i>&nbsp;                                final NameIdPair nameIdPair,
<i class="no-highlight">331</i>&nbsp;                                final Clock clock,
<i class="no-highlight">332</i>&nbsp;                                final int protocolVersion,
<i class="no-highlight">333</i>&nbsp;                                final int groupFormatVersion) {
<i class="no-highlight">334</i>&nbsp;
<b class="nc"><i class="no-highlight">335</i>&nbsp;        return new Protocol(repImpl, nameIdPair, clock,</b>
<i class="no-highlight">336</i>&nbsp;                            protocolVersion, protocolVersion,
<i class="no-highlight">337</i>&nbsp;                            LogEntryType.LOG_VERSION, groupFormatVersion);
<i class="no-highlight">338</i>&nbsp;    }
<i class="no-highlight">339</i>&nbsp;
<i class="no-highlight">340</i>&nbsp;    /**
<i class="no-highlight">341</i>&nbsp;     * Returns true if the code can support the version.
<i class="no-highlight">342</i>&nbsp;     *
<i class="no-highlight">343</i>&nbsp;     * @param protocolVersion protocol version being queried
<i class="no-highlight">344</i>&nbsp;     * @param minProtocolVersion minimum protocol version supported
<i class="no-highlight">345</i>&nbsp;     * @param maxProtocolVersion maximum protocol version supported
<i class="no-highlight">346</i>&nbsp;     *
<i class="no-highlight">347</i>&nbsp;     * @return true if the protocol version is supported by this implementation
<i class="no-highlight">348</i>&nbsp;     *         of the protocol
<i class="no-highlight">349</i>&nbsp;     */
<i class="no-highlight">350</i>&nbsp;    private static boolean isSupportedVersion(final int protocolVersion,
<i class="no-highlight">351</i>&nbsp;                                              final int minProtocolVersion,
<i class="no-highlight">352</i>&nbsp;                                              final int maxProtocolVersion) {
<b class="nc"><i class="no-highlight">353</i>&nbsp;        if (protocolVersion == Integer.MIN_VALUE) {</b>
<i class="no-highlight">354</i>&nbsp;            /* For testing purposes. */
<b class="nc"><i class="no-highlight">355</i>&nbsp;            return false;</b>
<i class="no-highlight">356</i>&nbsp;        }
<i class="no-highlight">357</i>&nbsp;
<i class="no-highlight">358</i>&nbsp;        /*
<i class="no-highlight">359</i>&nbsp;         * Version compatibility check: for now, a simple range check.  We can
<i class="no-highlight">360</i>&nbsp;         * make this fancier in the future if necessary.
<i class="no-highlight">361</i>&nbsp;         */
<b class="nc"><i class="no-highlight">362</i>&nbsp;        return minProtocolVersion &lt;= protocolVersion &amp;&amp;</b>
<i class="no-highlight">363</i>&nbsp;            protocolVersion &lt;= maxProtocolVersion;
<i class="no-highlight">364</i>&nbsp;    }
<i class="no-highlight">365</i>&nbsp;
<i class="no-highlight">366</i>&nbsp;    /**
<i class="no-highlight">367</i>&nbsp;     * Gets the JE version that corresponds to the specified protocol version,
<i class="no-highlight">368</i>&nbsp;     * for use in creating error messages that explain protocol version errors
<i class="no-highlight">369</i>&nbsp;     * in terms of JE versions.  Returns null if the associated version is not
<i class="no-highlight">370</i>&nbsp;     * known.
<i class="no-highlight">371</i>&nbsp;     */
<i class="no-highlight">372</i>&nbsp;    static JEVersion getProtocolJEVersion(final int protocolVersion) {
<b class="nc"><i class="no-highlight">373</i>&nbsp;        switch (protocolVersion) {</b>
<i class="no-highlight">374</i>&nbsp;        case VERSION_7:
<b class="nc"><i class="no-highlight">375</i>&nbsp;            return VERSION_7_JE_VERSION;</b>
<i class="no-highlight">376</i>&nbsp;        case VERSION_6:
<b class="nc"><i class="no-highlight">377</i>&nbsp;            return VERSION_6_JE_VERSION;</b>
<i class="no-highlight">378</i>&nbsp;        case VERSION_5:
<b class="nc"><i class="no-highlight">379</i>&nbsp;            return VERSION_5_JE_VERSION;</b>
<i class="no-highlight">380</i>&nbsp;        case VERSION_4:
<b class="nc"><i class="no-highlight">381</i>&nbsp;            return VERSION_4_JE_VERSION;</b>
<i class="no-highlight">382</i>&nbsp;        case VERSION_3:
<b class="nc"><i class="no-highlight">383</i>&nbsp;            return VERSION_3_JE_VERSION;</b>
<i class="no-highlight">384</i>&nbsp;        default:
<b class="nc"><i class="no-highlight">385</i>&nbsp;            return null;</b>
<i class="no-highlight">386</i>&nbsp;        }
<i class="no-highlight">387</i>&nbsp;    }
<i class="no-highlight">388</i>&nbsp;
<i class="no-highlight">389</i>&nbsp;    /**
<i class="no-highlight">390</i>&nbsp;     * Gets the protocol version that corresponds to the specified JE version,
<i class="no-highlight">391</i>&nbsp;     * throwing an IllegalArgumentException if the version is not supported.
<i class="no-highlight">392</i>&nbsp;     */
<i class="no-highlight">393</i>&nbsp;    static int getJEVersionProtocolVersion(final JEVersion jeVersion) {
<b class="nc"><i class="no-highlight">394</i>&nbsp;        if (jeVersion == null) {</b>
<b class="nc"><i class="no-highlight">395</i>&nbsp;            return VERSION_7;</b>
<b class="nc"><i class="no-highlight">396</i>&nbsp;        } else if (jeVersion.compareTo(VERSION_7_JE_VERSION) &gt;= 0) {</b>
<b class="nc"><i class="no-highlight">397</i>&nbsp;            return VERSION_7;</b>
<b class="nc"><i class="no-highlight">398</i>&nbsp;        } else if (jeVersion.compareTo(VERSION_6_JE_VERSION) &gt;= 0) {</b>
<b class="nc"><i class="no-highlight">399</i>&nbsp;            return VERSION_6;</b>
<b class="nc"><i class="no-highlight">400</i>&nbsp;        } else if (jeVersion.compareTo(VERSION_5_JE_VERSION) &gt;= 0) {</b>
<b class="nc"><i class="no-highlight">401</i>&nbsp;            return VERSION_5;</b>
<b class="nc"><i class="no-highlight">402</i>&nbsp;        } else if (jeVersion.compareTo(VERSION_4_JE_VERSION) &gt;= 0) {</b>
<b class="nc"><i class="no-highlight">403</i>&nbsp;            return VERSION_4;</b>
<b class="nc"><i class="no-highlight">404</i>&nbsp;        } else if (jeVersion.compareTo(VERSION_3_JE_VERSION) &gt;= 0) {</b>
<b class="nc"><i class="no-highlight">405</i>&nbsp;            return VERSION_3;</b>
<i class="no-highlight">406</i>&nbsp;        } else {
<b class="nc"><i class="no-highlight">407</i>&nbsp;            throw new IllegalArgumentException(</b>
<i class="no-highlight">408</i>&nbsp;                &quot;JE version not supported: &quot; + jeVersion);
<i class="no-highlight">409</i>&nbsp;        }
<i class="no-highlight">410</i>&nbsp;    }
<i class="no-highlight">411</i>&nbsp;
<i class="no-highlight">412</i>&nbsp;    /**
<i class="no-highlight">413</i>&nbsp;     * The replica sends the feeder its protocol version.
<i class="no-highlight">414</i>&nbsp;     *
<i class="no-highlight">415</i>&nbsp;     * IMPORTANT: This message must not change.
<i class="no-highlight">416</i>&nbsp;     */
<i class="no-highlight">417</i>&nbsp;    public class ReplicaProtocolVersion extends ProtocolVersion {
<i class="no-highlight">418</i>&nbsp;
<b class="nc"><i class="no-highlight">419</i>&nbsp;        public ReplicaProtocolVersion() {</b>
<b class="nc"><i class="no-highlight">420</i>&nbsp;            super(configuredVersion);</b>
<i class="no-highlight">421</i>&nbsp;        }
<i class="no-highlight">422</i>&nbsp;
<b class="nc"><i class="no-highlight">423</i>&nbsp;        public ReplicaProtocolVersion(ByteBuffer buffer) {</b>
<b class="nc"><i class="no-highlight">424</i>&nbsp;            super(buffer);</b>
<i class="no-highlight">425</i>&nbsp;        }
<i class="no-highlight">426</i>&nbsp;
<i class="no-highlight">427</i>&nbsp;        @Override
<i class="no-highlight">428</i>&nbsp;        public MessageOp getOp() {
<b class="nc"><i class="no-highlight">429</i>&nbsp;            return REPLICA_PROTOCOL_VERSION;</b>
<i class="no-highlight">430</i>&nbsp;        }
<i class="no-highlight">431</i>&nbsp;    }
<i class="no-highlight">432</i>&nbsp;
<i class="no-highlight">433</i>&nbsp;    /**
<i class="no-highlight">434</i>&nbsp;     * The feeder sends the replica its proposed version.
<i class="no-highlight">435</i>&nbsp;     *
<i class="no-highlight">436</i>&nbsp;     * IMPORTANT: This message must not change.
<i class="no-highlight">437</i>&nbsp;     */
<i class="no-highlight">438</i>&nbsp;    public class FeederProtocolVersion extends ProtocolVersion {
<i class="no-highlight">439</i>&nbsp;
<b class="nc"><i class="no-highlight">440</i>&nbsp;        public FeederProtocolVersion(int proposedVersion) {</b>
<b class="nc"><i class="no-highlight">441</i>&nbsp;            super(proposedVersion);</b>
<i class="no-highlight">442</i>&nbsp;        }
<i class="no-highlight">443</i>&nbsp;
<b class="nc"><i class="no-highlight">444</i>&nbsp;        public FeederProtocolVersion(ByteBuffer buffer) {</b>
<b class="nc"><i class="no-highlight">445</i>&nbsp;            super(buffer);</b>
<i class="no-highlight">446</i>&nbsp;        }
<i class="no-highlight">447</i>&nbsp;
<i class="no-highlight">448</i>&nbsp;        @Override
<i class="no-highlight">449</i>&nbsp;        public MessageOp getOp() {
<b class="nc"><i class="no-highlight">450</i>&nbsp;            return FEEDER_PROTOCOL_VERSION;</b>
<i class="no-highlight">451</i>&nbsp;        }
<i class="no-highlight">452</i>&nbsp;    }
<i class="no-highlight">453</i>&nbsp;
<i class="no-highlight">454</i>&nbsp;    /* Reject response to a ReplicaProtocolVersion request */
<i class="no-highlight">455</i>&nbsp;    public class DuplicateNodeReject extends RejectMessage {
<i class="no-highlight">456</i>&nbsp;
<b class="nc"><i class="no-highlight">457</i>&nbsp;        DuplicateNodeReject(String errorMessage) {</b>
<b class="nc"><i class="no-highlight">458</i>&nbsp;            super(errorMessage);</b>
<i class="no-highlight">459</i>&nbsp;        }
<i class="no-highlight">460</i>&nbsp;
<b class="nc"><i class="no-highlight">461</i>&nbsp;        public DuplicateNodeReject(ByteBuffer buffer) {</b>
<b class="nc"><i class="no-highlight">462</i>&nbsp;            super(buffer);</b>
<i class="no-highlight">463</i>&nbsp;        }
<i class="no-highlight">464</i>&nbsp;
<i class="no-highlight">465</i>&nbsp;        @Override
<i class="no-highlight">466</i>&nbsp;        public MessageOp getOp() {
<b class="nc"><i class="no-highlight">467</i>&nbsp;            return DUP_NODE_REJECT;</b>
<i class="no-highlight">468</i>&nbsp;        }
<i class="no-highlight">469</i>&nbsp;    }
<i class="no-highlight">470</i>&nbsp;
<b class="nc"><i class="no-highlight">471</i>&nbsp;    public class SNTPRequest extends HandshakeMessage {</b>
<i class="no-highlight">472</i>&nbsp;
<i class="no-highlight">473</i>&nbsp;        private final long originateTimestamp;
<i class="no-highlight">474</i>&nbsp;
<i class="no-highlight">475</i>&nbsp;        /* Set by the receiver at the time the message is recreated. */
<b class="nc"><i class="no-highlight">476</i>&nbsp;        private long receiveTimestamp = -1;</b>
<i class="no-highlight">477</i>&nbsp;
<i class="no-highlight">478</i>&nbsp;        /*
<i class="no-highlight">479</i>&nbsp;         * Determines whether this is the last in a consecutive stream of
<i class="no-highlight">480</i>&nbsp;         * requests to determine the skew.
<i class="no-highlight">481</i>&nbsp;         */
<b class="nc"><i class="no-highlight">482</i>&nbsp;        private boolean isLast = true;</b>
<i class="no-highlight">483</i>&nbsp;
<b class="nc"><i class="no-highlight">484</i>&nbsp;        public SNTPRequest(boolean isLast) {</b>
<b class="nc"><i class="no-highlight">485</i>&nbsp;            super();</b>
<b class="nc"><i class="no-highlight">486</i>&nbsp;            this.isLast = isLast;</b>
<b class="nc"><i class="no-highlight">487</i>&nbsp;            originateTimestamp = clock.currentTimeMillis();</b>
<i class="no-highlight">488</i>&nbsp;        }
<i class="no-highlight">489</i>&nbsp;
<i class="no-highlight">490</i>&nbsp;        @Override
<i class="no-highlight">491</i>&nbsp;        public ByteBuffer wireFormat() {
<b class="nc"><i class="no-highlight">492</i>&nbsp;            return wireFormat(originateTimestamp, isLast);</b>
<i class="no-highlight">493</i>&nbsp;        }
<i class="no-highlight">494</i>&nbsp;
<b class="nc"><i class="no-highlight">495</i>&nbsp;        public SNTPRequest(ByteBuffer buffer) {</b>
<b class="nc"><i class="no-highlight">496</i>&nbsp;            this.originateTimestamp = LogUtils.readLong(buffer);</b>
<b class="nc"><i class="no-highlight">497</i>&nbsp;            this.isLast = getBoolean(buffer);</b>
<b class="nc"><i class="no-highlight">498</i>&nbsp;            this.receiveTimestamp = clock.currentTimeMillis();</b>
<i class="no-highlight">499</i>&nbsp;        }
<i class="no-highlight">500</i>&nbsp;
<i class="no-highlight">501</i>&nbsp;        @Override
<i class="no-highlight">502</i>&nbsp;        public MessageOp getOp() {
<b class="nc"><i class="no-highlight">503</i>&nbsp;            return SNTP_REQUEST;</b>
<i class="no-highlight">504</i>&nbsp;        }
<i class="no-highlight">505</i>&nbsp;
<i class="no-highlight">506</i>&nbsp;        public long getOriginateTimestamp() {
<b class="nc"><i class="no-highlight">507</i>&nbsp;            return originateTimestamp;</b>
<i class="no-highlight">508</i>&nbsp;        }
<i class="no-highlight">509</i>&nbsp;
<i class="no-highlight">510</i>&nbsp;        public long getReceiveTimestamp() {
<b class="nc"><i class="no-highlight">511</i>&nbsp;            return receiveTimestamp;</b>
<i class="no-highlight">512</i>&nbsp;        }
<i class="no-highlight">513</i>&nbsp;
<i class="no-highlight">514</i>&nbsp;        public boolean isLast() {
<b class="nc"><i class="no-highlight">515</i>&nbsp;            return isLast;</b>
<i class="no-highlight">516</i>&nbsp;        }
<i class="no-highlight">517</i>&nbsp;    }
<i class="no-highlight">518</i>&nbsp;
<b class="nc"><i class="no-highlight">519</i>&nbsp;    public class SNTPResponse extends HandshakeMessage {</b>
<i class="no-highlight">520</i>&nbsp;
<i class="no-highlight">521</i>&nbsp;        /* These fields have the standard SNTP interpretation */
<i class="no-highlight">522</i>&nbsp;        private final long originateTimestamp; // time request sent by client
<i class="no-highlight">523</i>&nbsp;        private final long receiveTimestamp; // time request received by server
<i class="no-highlight">524</i>&nbsp;
<i class="no-highlight">525</i>&nbsp;        /*
<i class="no-highlight">526</i>&nbsp;         * Initialized when the message is serialized to ensure it&#39;s as
<i class="no-highlight">527</i>&nbsp;         * accurate as possible.
<i class="no-highlight">528</i>&nbsp;         */
<b class="nc"><i class="no-highlight">529</i>&nbsp;        private long transmitTimestamp = -1; // time reply sent by server</b>
<i class="no-highlight">530</i>&nbsp;
<i class="no-highlight">531</i>&nbsp;        /* Initialized at de-serialization for similar reasons. */
<b class="nc"><i class="no-highlight">532</i>&nbsp;        private long destinationTimestamp = -1; //time reply received by client</b>
<i class="no-highlight">533</i>&nbsp;
<b class="nc"><i class="no-highlight">534</i>&nbsp;        public SNTPResponse(SNTPRequest request) {</b>
<b class="nc"><i class="no-highlight">535</i>&nbsp;            this.originateTimestamp = request.originateTimestamp;</b>
<b class="nc"><i class="no-highlight">536</i>&nbsp;            this.receiveTimestamp = request.receiveTimestamp;</b>
<i class="no-highlight">537</i>&nbsp;        }
<i class="no-highlight">538</i>&nbsp;
<i class="no-highlight">539</i>&nbsp;        @Override
<i class="no-highlight">540</i>&nbsp;        public ByteBuffer wireFormat() {
<b class="nc"><i class="no-highlight">541</i>&nbsp;            transmitTimestamp = clock.currentTimeMillis();</b>
<b class="nc"><i class="no-highlight">542</i>&nbsp;            return wireFormat(originateTimestamp,</b>
<b class="nc"><i class="no-highlight">543</i>&nbsp;                              receiveTimestamp,</b>
<b class="nc"><i class="no-highlight">544</i>&nbsp;                              transmitTimestamp);</b>
<i class="no-highlight">545</i>&nbsp;        }
<i class="no-highlight">546</i>&nbsp;
<b class="nc"><i class="no-highlight">547</i>&nbsp;        public SNTPResponse(ByteBuffer buffer) {</b>
<b class="nc"><i class="no-highlight">548</i>&nbsp;            originateTimestamp = LogUtils.readLong(buffer);</b>
<b class="nc"><i class="no-highlight">549</i>&nbsp;            receiveTimestamp = LogUtils.readLong(buffer);</b>
<b class="nc"><i class="no-highlight">550</i>&nbsp;            transmitTimestamp = LogUtils.readLong(buffer);</b>
<b class="nc"><i class="no-highlight">551</i>&nbsp;            destinationTimestamp = clock.currentTimeMillis();</b>
<i class="no-highlight">552</i>&nbsp;        }
<i class="no-highlight">553</i>&nbsp;
<i class="no-highlight">554</i>&nbsp;        @Override
<i class="no-highlight">555</i>&nbsp;        public MessageOp getOp() {
<b class="nc"><i class="no-highlight">556</i>&nbsp;            return SNTP_RESPONSE;</b>
<i class="no-highlight">557</i>&nbsp;        }
<i class="no-highlight">558</i>&nbsp;
<i class="no-highlight">559</i>&nbsp;        public long getOriginateTimestamp() {
<b class="nc"><i class="no-highlight">560</i>&nbsp;            return originateTimestamp;</b>
<i class="no-highlight">561</i>&nbsp;        }
<i class="no-highlight">562</i>&nbsp;
<i class="no-highlight">563</i>&nbsp;        public long getReceiveTimestamp() {
<b class="nc"><i class="no-highlight">564</i>&nbsp;            return receiveTimestamp;</b>
<i class="no-highlight">565</i>&nbsp;        }
<i class="no-highlight">566</i>&nbsp;
<i class="no-highlight">567</i>&nbsp;        public long getTransmitTimestamp() {
<b class="nc"><i class="no-highlight">568</i>&nbsp;            return transmitTimestamp;</b>
<i class="no-highlight">569</i>&nbsp;        }
<i class="no-highlight">570</i>&nbsp;
<i class="no-highlight">571</i>&nbsp;        public long getDestinationTimestamp() {
<b class="nc"><i class="no-highlight">572</i>&nbsp;            return destinationTimestamp;</b>
<i class="no-highlight">573</i>&nbsp;        }
<i class="no-highlight">574</i>&nbsp;
<i class="no-highlight">575</i>&nbsp;        public long getDelay() {
<b class="nc"><i class="no-highlight">576</i>&nbsp;            assert(destinationTimestamp != -1);</b>
<b class="nc"><i class="no-highlight">577</i>&nbsp;            return (destinationTimestamp - originateTimestamp) -</b>
<i class="no-highlight">578</i>&nbsp;                    (transmitTimestamp - receiveTimestamp);
<i class="no-highlight">579</i>&nbsp;        }
<i class="no-highlight">580</i>&nbsp;
<i class="no-highlight">581</i>&nbsp;        public long getDelta() {
<b class="nc"><i class="no-highlight">582</i>&nbsp;            assert(destinationTimestamp != -1);</b>
<b class="nc"><i class="no-highlight">583</i>&nbsp;            return ((receiveTimestamp - originateTimestamp) +</b>
<i class="no-highlight">584</i>&nbsp;                    (transmitTimestamp - destinationTimestamp))/2;
<i class="no-highlight">585</i>&nbsp;        }
<i class="no-highlight">586</i>&nbsp;    }
<i class="no-highlight">587</i>&nbsp;
<i class="no-highlight">588</i>&nbsp;    public class ReAuthenticate extends SimpleMessage {
<i class="no-highlight">589</i>&nbsp;
<i class="no-highlight">590</i>&nbsp;        private final byte[] tokenBytes;
<i class="no-highlight">591</i>&nbsp;
<b class="nc"><i class="no-highlight">592</i>&nbsp;        public ReAuthenticate(byte[] tokenBytes) {</b>
<b class="nc"><i class="no-highlight">593</i>&nbsp;            this.tokenBytes = tokenBytes;</b>
<i class="no-highlight">594</i>&nbsp;        }
<i class="no-highlight">595</i>&nbsp;
<i class="no-highlight">596</i>&nbsp;        @Override
<i class="no-highlight">597</i>&nbsp;        public ByteBuffer wireFormat() {
<b class="nc"><i class="no-highlight">598</i>&nbsp;            return wireFormat(tokenBytes);</b>
<i class="no-highlight">599</i>&nbsp;        }
<i class="no-highlight">600</i>&nbsp;
<b class="nc"><i class="no-highlight">601</i>&nbsp;        public ReAuthenticate(ByteBuffer buffer) {</b>
<b class="nc"><i class="no-highlight">602</i>&nbsp;            tokenBytes = getByteArray(buffer);</b>
<i class="no-highlight">603</i>&nbsp;        }
<i class="no-highlight">604</i>&nbsp;
<i class="no-highlight">605</i>&nbsp;        public byte[] getTokenBytes() {
<b class="nc"><i class="no-highlight">606</i>&nbsp;            if (tokenBytes.length == 0) {</b>
<b class="nc"><i class="no-highlight">607</i>&nbsp;                return null;</b>
<i class="no-highlight">608</i>&nbsp;            }
<i class="no-highlight">609</i>&nbsp;
<b class="nc"><i class="no-highlight">610</i>&nbsp;            return tokenBytes;</b>
<i class="no-highlight">611</i>&nbsp;        }
<i class="no-highlight">612</i>&nbsp;
<i class="no-highlight">613</i>&nbsp;        @Override
<i class="no-highlight">614</i>&nbsp;        public MessageOp getOp() {
<b class="nc"><i class="no-highlight">615</i>&nbsp;            return REAUTHENTICATE;</b>
<i class="no-highlight">616</i>&nbsp;        }
<i class="no-highlight">617</i>&nbsp;    }
<i class="no-highlight">618</i>&nbsp;
<i class="no-highlight">619</i>&nbsp;    /**
<i class="no-highlight">620</i>&nbsp;     * Abstract message used as the basis for the exchange of software versions
<i class="no-highlight">621</i>&nbsp;     * between replicated nodes
<i class="no-highlight">622</i>&nbsp;     */
<i class="no-highlight">623</i>&nbsp;    abstract class JEVersions extends HandshakeMessage {
<i class="no-highlight">624</i>&nbsp;        private final JEVersion version;
<i class="no-highlight">625</i>&nbsp;
<i class="no-highlight">626</i>&nbsp;        private final int logVersion;
<i class="no-highlight">627</i>&nbsp;
<b class="nc"><i class="no-highlight">628</i>&nbsp;        public JEVersions(JEVersion version, int logVersion) {</b>
<b class="nc"><i class="no-highlight">629</i>&nbsp;            this.version = version;</b>
<b class="nc"><i class="no-highlight">630</i>&nbsp;            this.logVersion = logVersion;</b>
<i class="no-highlight">631</i>&nbsp;        }
<i class="no-highlight">632</i>&nbsp;
<i class="no-highlight">633</i>&nbsp;        @Override
<i class="no-highlight">634</i>&nbsp;        public ByteBuffer wireFormat() {
<b class="nc"><i class="no-highlight">635</i>&nbsp;            return wireFormat(version.getVersionString(), logVersion);</b>
<i class="no-highlight">636</i>&nbsp;        }
<i class="no-highlight">637</i>&nbsp;
<b class="nc"><i class="no-highlight">638</i>&nbsp;        public JEVersions(ByteBuffer buffer) {</b>
<b class="nc"><i class="no-highlight">639</i>&nbsp;            this.version = new JEVersion(getString(buffer));</b>
<b class="nc"><i class="no-highlight">640</i>&nbsp;            this.logVersion = LogUtils.readInt(buffer);</b>
<i class="no-highlight">641</i>&nbsp;        }
<i class="no-highlight">642</i>&nbsp;
<i class="no-highlight">643</i>&nbsp;        public JEVersion getVersion() {
<b class="nc"><i class="no-highlight">644</i>&nbsp;            return version;</b>
<i class="no-highlight">645</i>&nbsp;        }
<i class="no-highlight">646</i>&nbsp;
<i class="no-highlight">647</i>&nbsp;        public byte getLogVersion() {
<b class="nc"><i class="no-highlight">648</i>&nbsp;            return (byte)logVersion;</b>
<i class="no-highlight">649</i>&nbsp;        }
<i class="no-highlight">650</i>&nbsp;    }
<i class="no-highlight">651</i>&nbsp;
<i class="no-highlight">652</i>&nbsp;    public class ReplicaJEVersions extends JEVersions {
<i class="no-highlight">653</i>&nbsp;
<b class="nc"><i class="no-highlight">654</i>&nbsp;        ReplicaJEVersions(JEVersion version, int logVersion) {</b>
<b class="nc"><i class="no-highlight">655</i>&nbsp;            super(version, logVersion);</b>
<i class="no-highlight">656</i>&nbsp;        }
<i class="no-highlight">657</i>&nbsp;
<b class="nc"><i class="no-highlight">658</i>&nbsp;        public ReplicaJEVersions(ByteBuffer buffer) {</b>
<b class="nc"><i class="no-highlight">659</i>&nbsp;            super(buffer);</b>
<i class="no-highlight">660</i>&nbsp;        }
<i class="no-highlight">661</i>&nbsp;
<i class="no-highlight">662</i>&nbsp;        @Override
<i class="no-highlight">663</i>&nbsp;        public MessageOp getOp() {
<b class="nc"><i class="no-highlight">664</i>&nbsp;            return REPLICA_JE_VERSIONS;</b>
<i class="no-highlight">665</i>&nbsp;        }
<i class="no-highlight">666</i>&nbsp;
<i class="no-highlight">667</i>&nbsp;    }
<i class="no-highlight">668</i>&nbsp;
<i class="no-highlight">669</i>&nbsp;    public class FeederJEVersions extends JEVersions {
<i class="no-highlight">670</i>&nbsp;
<i class="no-highlight">671</i>&nbsp;        /* Is null if protocol version &lt; VERSION_7. */
<i class="no-highlight">672</i>&nbsp;        private JEVersion minJEVersion;
<i class="no-highlight">673</i>&nbsp;
<i class="no-highlight">674</i>&nbsp;        FeederJEVersions(JEVersion version,
<i class="no-highlight">675</i>&nbsp;                         int logVersion,
<b class="nc"><i class="no-highlight">676</i>&nbsp;                         JEVersion minJEVersion) {</b>
<b class="nc"><i class="no-highlight">677</i>&nbsp;            super(version, logVersion);</b>
<b class="nc"><i class="no-highlight">678</i>&nbsp;            this.minJEVersion = minJEVersion;</b>
<i class="no-highlight">679</i>&nbsp;        }
<i class="no-highlight">680</i>&nbsp;
<i class="no-highlight">681</i>&nbsp;        @Override
<i class="no-highlight">682</i>&nbsp;        public ByteBuffer wireFormat() {
<b class="nc"><i class="no-highlight">683</i>&nbsp;            if (configuredVersion &lt; VERSION_7){</b>
<b class="nc"><i class="no-highlight">684</i>&nbsp;                return super.wireFormat();</b>
<i class="no-highlight">685</i>&nbsp;            }
<b class="nc"><i class="no-highlight">686</i>&nbsp;            return wireFormat(</b>
<b class="nc"><i class="no-highlight">687</i>&nbsp;                getVersion().getVersionString(),</b>
<b class="nc"><i class="no-highlight">688</i>&nbsp;                (int) getLogVersion(),</b>
<b class="nc"><i class="no-highlight">689</i>&nbsp;                minJEVersion.getVersionString());</b>
<i class="no-highlight">690</i>&nbsp;        }
<i class="no-highlight">691</i>&nbsp;
<b class="nc"><i class="no-highlight">692</i>&nbsp;        public FeederJEVersions(ByteBuffer buffer) {</b>
<b class="nc"><i class="no-highlight">693</i>&nbsp;            super(buffer);</b>
<b class="nc"><i class="no-highlight">694</i>&nbsp;            if (configuredVersion &lt; VERSION_7){</b>
<i class="no-highlight">695</i>&nbsp;                return;
<i class="no-highlight">696</i>&nbsp;            }
<b class="nc"><i class="no-highlight">697</i>&nbsp;            this.minJEVersion = new JEVersion(getString(buffer));</b>
<i class="no-highlight">698</i>&nbsp;        }
<i class="no-highlight">699</i>&nbsp;
<i class="no-highlight">700</i>&nbsp;        @Override
<i class="no-highlight">701</i>&nbsp;        public MessageOp getOp() {
<b class="nc"><i class="no-highlight">702</i>&nbsp;            return FEEDER_JE_VERSIONS;</b>
<i class="no-highlight">703</i>&nbsp;        }
<i class="no-highlight">704</i>&nbsp;
<i class="no-highlight">705</i>&nbsp;        /**
<i class="no-highlight">706</i>&nbsp;         * Returns the minJEVersion of the group, or null if unknown (in
<i class="no-highlight">707</i>&nbsp;         * protocol versions &lt; VERSION_7).
<i class="no-highlight">708</i>&nbsp;         */
<i class="no-highlight">709</i>&nbsp;        public JEVersion getMinJEVersion() {
<b class="nc"><i class="no-highlight">710</i>&nbsp;            return minJEVersion;</b>
<i class="no-highlight">711</i>&nbsp;        }
<i class="no-highlight">712</i>&nbsp;    }
<i class="no-highlight">713</i>&nbsp;
<i class="no-highlight">714</i>&nbsp;    /* Reject response to a ReplicaJEVersions request */
<i class="no-highlight">715</i>&nbsp;    public class JEVersionsReject extends RejectMessage {
<i class="no-highlight">716</i>&nbsp;
<b class="nc"><i class="no-highlight">717</i>&nbsp;        public JEVersionsReject(String errorMessage) {</b>
<b class="nc"><i class="no-highlight">718</i>&nbsp;            super(errorMessage);</b>
<i class="no-highlight">719</i>&nbsp;        }
<i class="no-highlight">720</i>&nbsp;
<b class="nc"><i class="no-highlight">721</i>&nbsp;        public JEVersionsReject(ByteBuffer buffer) {</b>
<b class="nc"><i class="no-highlight">722</i>&nbsp;            super(buffer);</b>
<i class="no-highlight">723</i>&nbsp;        }
<i class="no-highlight">724</i>&nbsp;
<i class="no-highlight">725</i>&nbsp;        @Override
<i class="no-highlight">726</i>&nbsp;        public MessageOp getOp() {
<b class="nc"><i class="no-highlight">727</i>&nbsp;            return JE_VERSIONS_REJECT;</b>
<i class="no-highlight">728</i>&nbsp;        }
<i class="no-highlight">729</i>&nbsp;    }
<i class="no-highlight">730</i>&nbsp;
<i class="no-highlight">731</i>&nbsp;    public class NodeGroupInfo extends HandshakeMessage {
<i class="no-highlight">732</i>&nbsp;        private final String groupName;
<i class="no-highlight">733</i>&nbsp;        private final UUID uuid;
<i class="no-highlight">734</i>&nbsp;
<i class="no-highlight">735</i>&nbsp;        @SuppressWarnings(&quot;hiding&quot;)
<i class="no-highlight">736</i>&nbsp;        private final NameIdPair nameIdPair;
<i class="no-highlight">737</i>&nbsp;        private final String hostName;
<i class="no-highlight">738</i>&nbsp;        private final int port;
<i class="no-highlight">739</i>&nbsp;        private final NodeType nodeType;
<i class="no-highlight">740</i>&nbsp;        private final boolean designatedPrimary;
<i class="no-highlight">741</i>&nbsp;
<i class="no-highlight">742</i>&nbsp;        /**
<i class="no-highlight">743</i>&nbsp;         * A string version of the JE version running on this node, or the
<i class="no-highlight">744</i>&nbsp;         * empty string if not known.
<i class="no-highlight">745</i>&nbsp;         */
<i class="no-highlight">746</i>&nbsp;        private final String jeVersion;
<i class="no-highlight">747</i>&nbsp;
<i class="no-highlight">748</i>&nbsp;        NodeGroupInfo(final String groupName,
<i class="no-highlight">749</i>&nbsp;                      final UUID uuid,
<i class="no-highlight">750</i>&nbsp;                      final NameIdPair nameIdPair,
<i class="no-highlight">751</i>&nbsp;                      final String hostName,
<i class="no-highlight">752</i>&nbsp;                      final int port,
<i class="no-highlight">753</i>&nbsp;                      final NodeType nodeType,
<i class="no-highlight">754</i>&nbsp;                      final boolean designatedPrimary,
<b class="nc"><i class="no-highlight">755</i>&nbsp;                      final JEVersion jeVersion) {</b>
<i class="no-highlight">756</i>&nbsp;
<b class="nc"><i class="no-highlight">757</i>&nbsp;            this.groupName = groupName;</b>
<b class="nc"><i class="no-highlight">758</i>&nbsp;            this.uuid = uuid;</b>
<b class="nc"><i class="no-highlight">759</i>&nbsp;            this.nameIdPair = nameIdPair;</b>
<b class="nc"><i class="no-highlight">760</i>&nbsp;            this.hostName = hostName;</b>
<b class="nc"><i class="no-highlight">761</i>&nbsp;            this.port = port;</b>
<b class="nc"><i class="no-highlight">762</i>&nbsp;            this.nodeType = nodeType;</b>
<b class="nc"><i class="no-highlight">763</i>&nbsp;            this.designatedPrimary = designatedPrimary;</b>
<b class="nc"><i class="no-highlight">764</i>&nbsp;            this.jeVersion = (jeVersion != null) ?</b>
<b class="nc"><i class="no-highlight">765</i>&nbsp;                jeVersion.getNumericVersionString() :</b>
<i class="no-highlight">766</i>&nbsp;                &quot;&quot;;
<i class="no-highlight">767</i>&nbsp;        }
<i class="no-highlight">768</i>&nbsp;
<i class="no-highlight">769</i>&nbsp;        @Override
<i class="no-highlight">770</i>&nbsp;        public MessageOp getOp() {
<b class="nc"><i class="no-highlight">771</i>&nbsp;            return MEMBERSHIP_INFO;</b>
<i class="no-highlight">772</i>&nbsp;        }
<i class="no-highlight">773</i>&nbsp;
<i class="no-highlight">774</i>&nbsp;        @Override
<i class="no-highlight">775</i>&nbsp;        public ByteBuffer wireFormat() {
<b class="nc"><i class="no-highlight">776</i>&nbsp;            final boolean repGroupV3 = (getVersion() &gt;= VERSION_5);</b>
<b class="nc"><i class="no-highlight">777</i>&nbsp;            if (!repGroupV3 &amp;&amp; nodeType.compareTo(NodeType.ELECTABLE) &gt; 0) {</b>
<b class="nc"><i class="no-highlight">778</i>&nbsp;                throw new IllegalStateException(</b>
<i class="no-highlight">779</i>&nbsp;                    &quot;Node type not supported before group version 3: &quot; +
<i class="no-highlight">780</i>&nbsp;                    nodeType);
<i class="no-highlight">781</i>&nbsp;            }
<b class="nc"><i class="no-highlight">782</i>&nbsp;            final Object[] args = new Object[repGroupV3 ? 9 : 8];</b>
<b class="nc"><i class="no-highlight">783</i>&nbsp;            args[0] = groupName;</b>
<b class="nc"><i class="no-highlight">784</i>&nbsp;            args[1] = uuid.getMostSignificantBits();</b>
<b class="nc"><i class="no-highlight">785</i>&nbsp;            args[2] = uuid.getLeastSignificantBits();</b>
<b class="nc"><i class="no-highlight">786</i>&nbsp;            args[3] = nameIdPair;</b>
<b class="nc"><i class="no-highlight">787</i>&nbsp;            args[4] = hostName;</b>
<b class="nc"><i class="no-highlight">788</i>&nbsp;            args[5] = port;</b>
<b class="nc"><i class="no-highlight">789</i>&nbsp;            args[6] = nodeType;</b>
<b class="nc"><i class="no-highlight">790</i>&nbsp;            args[7] = designatedPrimary;</b>
<b class="nc"><i class="no-highlight">791</i>&nbsp;            if (repGroupV3) {</b>
<b class="nc"><i class="no-highlight">792</i>&nbsp;                args[8] = jeVersion;</b>
<i class="no-highlight">793</i>&nbsp;            }
<b class="nc"><i class="no-highlight">794</i>&nbsp;            return wireFormat(args);</b>
<i class="no-highlight">795</i>&nbsp;        }
<i class="no-highlight">796</i>&nbsp;
<b class="nc"><i class="no-highlight">797</i>&nbsp;        public NodeGroupInfo(ByteBuffer buffer) {</b>
<b class="nc"><i class="no-highlight">798</i>&nbsp;            this.groupName = getString(buffer);</b>
<b class="nc"><i class="no-highlight">799</i>&nbsp;            this.uuid = new UUID(LogUtils.readLong(buffer),</b>
<b class="nc"><i class="no-highlight">800</i>&nbsp;                                 LogUtils.readLong(buffer));</b>
<b class="nc"><i class="no-highlight">801</i>&nbsp;            this.nameIdPair = getNameIdPair(buffer);</b>
<b class="nc"><i class="no-highlight">802</i>&nbsp;            this.hostName = getString(buffer);</b>
<b class="nc"><i class="no-highlight">803</i>&nbsp;            this.port = LogUtils.readInt(buffer);</b>
<b class="nc"><i class="no-highlight">804</i>&nbsp;            this.nodeType = getEnum(NodeType.class, buffer);</b>
<b class="nc"><i class="no-highlight">805</i>&nbsp;            this.designatedPrimary = getBoolean(buffer);</b>
<b class="nc"><i class="no-highlight">806</i>&nbsp;            jeVersion = (getVersion() &gt;= VERSION_5) ? getString(buffer) : &quot;&quot;;</b>
<i class="no-highlight">807</i>&nbsp;        }
<i class="no-highlight">808</i>&nbsp;
<i class="no-highlight">809</i>&nbsp;        public String getGroupName() {
<b class="nc"><i class="no-highlight">810</i>&nbsp;            return groupName;</b>
<i class="no-highlight">811</i>&nbsp;        }
<i class="no-highlight">812</i>&nbsp;
<i class="no-highlight">813</i>&nbsp;        public UUID getUUID() {
<b class="nc"><i class="no-highlight">814</i>&nbsp;            return uuid;</b>
<i class="no-highlight">815</i>&nbsp;        }
<i class="no-highlight">816</i>&nbsp;
<i class="no-highlight">817</i>&nbsp;        public String getNodeName() {
<b class="nc"><i class="no-highlight">818</i>&nbsp;            return nameIdPair.getName();</b>
<i class="no-highlight">819</i>&nbsp;        }
<i class="no-highlight">820</i>&nbsp;
<i class="no-highlight">821</i>&nbsp;        public int getNodeId() {
<b class="nc"><i class="no-highlight">822</i>&nbsp;            return nameIdPair.getId();</b>
<i class="no-highlight">823</i>&nbsp;        }
<i class="no-highlight">824</i>&nbsp;
<i class="no-highlight">825</i>&nbsp;        public String getHostName() {
<b class="nc"><i class="no-highlight">826</i>&nbsp;            return hostName;</b>
<i class="no-highlight">827</i>&nbsp;        }
<i class="no-highlight">828</i>&nbsp;
<i class="no-highlight">829</i>&nbsp;        public NameIdPair getNameIdPair() {
<b class="nc"><i class="no-highlight">830</i>&nbsp;            return nameIdPair;</b>
<i class="no-highlight">831</i>&nbsp;        }
<i class="no-highlight">832</i>&nbsp;
<i class="no-highlight">833</i>&nbsp;        public int port() {
<b class="nc"><i class="no-highlight">834</i>&nbsp;            return port;</b>
<i class="no-highlight">835</i>&nbsp;        }
<i class="no-highlight">836</i>&nbsp;        public NodeType getNodeType() {
<b class="nc"><i class="no-highlight">837</i>&nbsp;            return nodeType;</b>
<i class="no-highlight">838</i>&nbsp;        }
<i class="no-highlight">839</i>&nbsp;
<i class="no-highlight">840</i>&nbsp;        public boolean isDesignatedPrimary() {
<b class="nc"><i class="no-highlight">841</i>&nbsp;            return designatedPrimary;</b>
<i class="no-highlight">842</i>&nbsp;        }
<i class="no-highlight">843</i>&nbsp;
<i class="no-highlight">844</i>&nbsp;        /**
<i class="no-highlight">845</i>&nbsp;         * Returns the JE version most recently noted running on the associated
<i class="no-highlight">846</i>&nbsp;         * node, or null if not known.
<i class="no-highlight">847</i>&nbsp;         */
<i class="no-highlight">848</i>&nbsp;        public JEVersion getJEVersion() {
<b class="nc"><i class="no-highlight">849</i>&nbsp;            return !jeVersion.isEmpty() ? new JEVersion(jeVersion) : null;</b>
<i class="no-highlight">850</i>&nbsp;        }
<i class="no-highlight">851</i>&nbsp;    }
<i class="no-highlight">852</i>&nbsp;
<i class="no-highlight">853</i>&nbsp;    /**
<i class="no-highlight">854</i>&nbsp;     * Response to a NodeGroupInfo request that was successful.  The object
<i class="no-highlight">855</i>&nbsp;     * contains the group&#39;s UUID and the replica&#39;s NameIdPair.  The group UUID
<i class="no-highlight">856</i>&nbsp;     * is used to update the replica&#39;s notion of the group UUID on first
<i class="no-highlight">857</i>&nbsp;     * joining.  The NameIdPair is used to update the replica&#39;s node ID for a
<i class="no-highlight">858</i>&nbsp;     * secondary node, which is not available in the RepGroupDB.
<i class="no-highlight">859</i>&nbsp;     */
<i class="no-highlight">860</i>&nbsp;    public class NodeGroupInfoOK extends HandshakeMessage {
<i class="no-highlight">861</i>&nbsp;
<i class="no-highlight">862</i>&nbsp;        private final UUID uuid;
<i class="no-highlight">863</i>&nbsp;        @SuppressWarnings(&quot;hiding&quot;)
<i class="no-highlight">864</i>&nbsp;        private final NameIdPair nameIdPair;
<i class="no-highlight">865</i>&nbsp;
<b class="nc"><i class="no-highlight">866</i>&nbsp;        public NodeGroupInfoOK(UUID uuid, NameIdPair nameIdPair) {</b>
<b class="nc"><i class="no-highlight">867</i>&nbsp;            super();</b>
<b class="nc"><i class="no-highlight">868</i>&nbsp;            this.uuid = uuid;</b>
<b class="nc"><i class="no-highlight">869</i>&nbsp;            this.nameIdPair = nameIdPair;</b>
<i class="no-highlight">870</i>&nbsp;        }
<i class="no-highlight">871</i>&nbsp;
<b class="nc"><i class="no-highlight">872</i>&nbsp;        public NodeGroupInfoOK(ByteBuffer buffer) {</b>
<b class="nc"><i class="no-highlight">873</i>&nbsp;            uuid = new UUID(LogUtils.readLong(buffer),</b>
<b class="nc"><i class="no-highlight">874</i>&nbsp;                            LogUtils.readLong(buffer));</b>
<b class="nc"><i class="no-highlight">875</i>&nbsp;            nameIdPair = getNameIdPair(buffer);</b>
<i class="no-highlight">876</i>&nbsp;        }
<i class="no-highlight">877</i>&nbsp;
<i class="no-highlight">878</i>&nbsp;        @Override
<i class="no-highlight">879</i>&nbsp;        public ByteBuffer wireFormat() {
<b class="nc"><i class="no-highlight">880</i>&nbsp;            return wireFormat(uuid.getMostSignificantBits(),</b>
<b class="nc"><i class="no-highlight">881</i>&nbsp;                              uuid.getLeastSignificantBits(),</b>
<i class="no-highlight">882</i>&nbsp;                              nameIdPair);
<i class="no-highlight">883</i>&nbsp;        }
<i class="no-highlight">884</i>&nbsp;
<i class="no-highlight">885</i>&nbsp;        @Override
<i class="no-highlight">886</i>&nbsp;        public MessageOp getOp() {
<b class="nc"><i class="no-highlight">887</i>&nbsp;            return MEMBERSHIP_INFO_OK;</b>
<i class="no-highlight">888</i>&nbsp;        }
<i class="no-highlight">889</i>&nbsp;
<i class="no-highlight">890</i>&nbsp;        public NameIdPair getNameIdPair() {
<b class="nc"><i class="no-highlight">891</i>&nbsp;            return nameIdPair;</b>
<i class="no-highlight">892</i>&nbsp;        }
<i class="no-highlight">893</i>&nbsp;
<i class="no-highlight">894</i>&nbsp;        public UUID getUUID() {
<b class="nc"><i class="no-highlight">895</i>&nbsp;            return uuid;</b>
<i class="no-highlight">896</i>&nbsp;        }
<i class="no-highlight">897</i>&nbsp;    }
<i class="no-highlight">898</i>&nbsp;
<i class="no-highlight">899</i>&nbsp;    public class NodeGroupInfoReject extends RejectMessage {
<i class="no-highlight">900</i>&nbsp;
<b class="nc"><i class="no-highlight">901</i>&nbsp;        NodeGroupInfoReject(String errorMessage) {</b>
<b class="nc"><i class="no-highlight">902</i>&nbsp;            super(errorMessage);</b>
<i class="no-highlight">903</i>&nbsp;        }
<i class="no-highlight">904</i>&nbsp;
<i class="no-highlight">905</i>&nbsp;        @Override
<i class="no-highlight">906</i>&nbsp;        public MessageOp getOp() {
<b class="nc"><i class="no-highlight">907</i>&nbsp;            return MEMBERSHIP_INFO_REJECT;</b>
<i class="no-highlight">908</i>&nbsp;        }
<i class="no-highlight">909</i>&nbsp;
<i class="no-highlight">910</i>&nbsp;        @Override
<i class="no-highlight">911</i>&nbsp;        public ByteBuffer wireFormat() {
<b class="nc"><i class="no-highlight">912</i>&nbsp;            return wireFormat(errorMessage);</b>
<i class="no-highlight">913</i>&nbsp;        }
<i class="no-highlight">914</i>&nbsp;
<b class="nc"><i class="no-highlight">915</i>&nbsp;        public NodeGroupInfoReject(ByteBuffer buffer) {</b>
<b class="nc"><i class="no-highlight">916</i>&nbsp;            super(buffer);</b>
<i class="no-highlight">917</i>&nbsp;        }
<i class="no-highlight">918</i>&nbsp;    }
<i class="no-highlight">919</i>&nbsp;
<i class="no-highlight">920</i>&nbsp;}
</div>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
        var codeBlock = document.getElementById('sourceCode');

        if (codeBlock) {
            hljs.highlightBlock(codeBlock);
        }
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2021-04-19 13:44</div>
</div>
</body>
</html>
